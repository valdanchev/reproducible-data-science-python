
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Exploratory Data Analysis and Visualisation &#8212; Reproducible Data Science + Python + Real-World Data</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e7340bb3dbd8dde6db86f25597f54a1b.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Discovering patterns in data" href="06_pattern_discovery_using_unsupervised_learning.html" />
    <link rel="prev" title="Data Design &amp; Data Wrangling" href="04_data_design_and_data_wrangling.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Reproducible Data Science + Python + Real-World Data</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Reproducible Data Science with Python
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  About the textbook
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="00_textbook_outline.html">
   Textbook outline
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="00_textbook_outline.html#what-is-reproducible-data-science">
   What is Reproducible Data Science?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="00_textbook_outline.html#learning-objectives">
   Learning objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="00_textbook_outline.html#how-to-get-the-most-of-these-materials">
   How to get the most of these materials?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="00_textbook_outline.html#learning-resources">
   Learning resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="00_textbook_outline.html#software-stack">
   Software stack
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="00_textbook_outline.html#data-sets">
   Data sets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="00_textbook_outline.html#acknowledgment">
   Acknowledgment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="00_textbook_outline.html#code-availability">
   Code availability
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  End-to-End Data Science Project
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html">
   Human mobility during UK lockdowns
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#let-s-formulate-our-research-question">
   Let’s formulate our research question
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#data-to-address-the-question">
   Data to address the question
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#get-started-with-jupyter-colab-notebook">
   Get started with Jupyter/Colab notebook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#let-s-get-coding">
   Let’s get coding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#python-tools-for-data-analysis">
   Python tools for data analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#load-your-data">
   Load your data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#view-your-data">
   View your data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#data-design-how-are-data-generated">
   Data Design: How are data generated?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#data-ethics-privacy-and-fairness-risks">
   Data Ethics, Privacy, and Fairness Risks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#describe-your-data">
   Describe your data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#exploratory-data-analysis">
   Exploratory data analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#data-wrangling">
   Data wrangling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#visualising-mobility-trends">
   Visualising mobility trends
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#mobility-changes-across-lockdowns">
   Mobility changes across lockdowns
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#zooming-in-regional-mobility-trends">
   Zooming in: Regional mobility trends
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#re-cap">
   Re-cap
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Python Data Science on the Cloud
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html">
   <strong>
    Python for Data Analysis on the Cloud
   </strong>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html#get-started-with-jupyter-colab-notebooks">
   Get Started with Jupyter &amp; Colab notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html#python-coding-for-data-analysis">
   Python Coding for Data Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html#descriptive-statistics-with-numpy">
   Descriptive statistics with
   <code class="docutils literal notranslate">
    <span class="pre">
     NumPy
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html#getting-help">
   Getting help
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html#readability-of-your-python-code">
   Readability of your Python code
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html#running-terminal-commands-in-jupyter-colab-notebook">
   Running Terminal commands in Jupyter/Colab notebook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html#installing-packages-with-pip">
   Installing packages with
   <code class="docutils literal notranslate">
    <span class="pre">
     pip
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html#jupyter-magic-commands">
   Jupyter magic commands
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html#loading-real-world-data-with-pandas">
   Loading real-world data with
   <code class="docutils literal notranslate">
    <span class="pre">
     pandas
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html#hands-on-exercise-let-s-practice-your-python-skills">
   Hands-on exercise: Let’s practice your Python skills
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html#markdown-text-cells">
   Markdown Text Cells
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html#hands-on-exercise-let-s-practice-your-markdown-skills">
   Hands-on exercise: Let’s practice your Markdown skills
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Open Reproducible Workflow
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="03_open_reproducible_workflows.html">
   Open Reproducible Data Science Workflow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_open_reproducible_workflows.html#what-is-computational-reproducibility-and-why-it-matters">
   What is computational reproducibility and why it matters?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_open_reproducible_workflows.html#open-reproducible-workflow-in-jupyter-colab-notebooks">
   Open Reproducible Workflow in Jupyter/Colab Notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_open_reproducible_workflows.html#rules-for-reproducible-workflow">
   Rules for Reproducible Workflow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_open_reproducible_workflows.html#reproducible-research-report">
   Reproducible research report
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_open_reproducible_workflows.html#recording-dependencies">
   Recording dependencies
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  data design &amp; data wrangling
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="04_data_design_and_data_wrangling.html">
   Data Design &amp; Data Wrangling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_data_design_and_data_wrangling.html#get-started-with-pandas">
   Get started with
   <code class="docutils literal notranslate">
    <span class="pre">
     pandas
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_data_design_and_data_wrangling.html#importing-pandas">
   Importing
   <code class="docutils literal notranslate">
    <span class="pre">
     pandas
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_data_design_and_data_wrangling.html#loading-your-data">
   Loading your data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_data_design_and_data_wrangling.html#loading-covid-19-data-sets-via-url">
   Loading Covid-19 data sets via URL
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_data_design_and_data_wrangling.html#viewing-describing-and-accessing-your-data">
   Viewing, Describing, and Accessing your Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_data_design_and_data_wrangling.html#accessing-columns-and-rows-in-your-data">
   Accessing columns and rows in your data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_data_design_and_data_wrangling.html#hands-on-exercise">
   Hands-on exercise
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_data_design_and_data_wrangling.html#handling-missing-values">
   Handling Missing Values
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_data_design_and_data_wrangling.html#compare-mobility-data-formats">
   Compare mobility data formats
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_data_design_and_data_wrangling.html#recording-dependencies">
   Recording dependencies
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Data Exploration &amp; Visualisation
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Exploratory Data Analysis and Visualisation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#learning-resources">
   Learning resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#addressing-simple-questions-via-python-eda">
   Addressing simple questions via Python EDA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#code-reuse-creating-your-own-functions">
   Code reuse: creating your own functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#rq1-how-do-countries-differ-in-mobility-trends">
   RQ1: How do countries differ in mobility trends?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#data-visualisation-with-seaborn">
   Data visualisation with Seaborn
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#changing-figure-appearance">
   Changing figure appearance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#wide-and-long-data-format">
   Wide and long data format
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#multi-plot-visualisations">
   Multi-plot visualisations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#hands-on-exercise">
   Hands-on exercise
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#rq2-how-do-mobility-trends-change-over-time">
   RQ2: How do mobility trends change over time?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#visualising-time-series-data">
   Visualising time series data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#bootstrapping-for-inference">
   Bootstrapping for inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#rq3-how-have-mobility-trends-differed-across-uk-lockdowns">
   RQ3: How have mobility trends differed across UK lockdowns?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#visualising-lockdowns-mobility-as-barplots">
   Visualising lockdowns’ mobility as barplots
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#rq4-how-have-mobility-trends-differed-across-uk-counties-during-the-third-lockdown">
   RQ4: How have mobility trends differed across UK counties during the third lockdown?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#id1">
   Multi-plot visualisations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#split-apply-combine">
   Split-apply-combine
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#summarising-data-by-groups">
   Summarising data by groups
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#rq5-how-do-mobility-categories-relate-to-each-other">
   RQ5: How do mobility categories relate to each other?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#visualising-distributions">
   Visualising distributions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#plotting-pairwise-relationships">
   Plotting pairwise relationships
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#rq6-how-correlated-are-mobility-categories-across-uk-counties">
   RQ6: How correlated are mobility categories across UK counties?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#visualising-correlation">
   Visualising correlation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#visualising-linear-regression">
   Visualising linear regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#recording-dependencies">
   Recording dependencies
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Pattern Discovery using Unsupervised Learning
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html">
   Discovering patterns in data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#machine-learning-what-is-it-what-is-it-good-for">
   Machine Learning: What is it? What is it good for?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#research-problem-clustering-counties-by-mobility">
   Research problem: clustering counties by mobility
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#k-means-clustering">
   <em>
    k
   </em>
   -means clustering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#let-s-get-coding-with-scikit-learn">
   Let’s get coding with
   <code class="docutils literal notranslate">
    <span class="pre">
     scikit-learn
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#data-preprocessing">
   Data preprocessing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#data-standardisation">
   Data standardisation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#choosing-the-optimal-number-of-clusters">
   Choosing the optimal number of clusters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#performing-for-loop">
   Performing
   <code class="docutils literal notranslate">
    <span class="pre">
     for
    </span>
   </code>
   loop
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#elbow-plot">
   Elbow plot
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#dimensionality-reduction-via-pca">
   Dimensionality Reduction via PCA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#visualising-mobility-clusters">
   Visualising mobility clusters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#related-approaches-hierarchical-clustering">
   Related approaches: Hierarchical clustering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#hands-on-exercise">
   Hands-on exercise
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Prediction using Supervised Learning
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html">
   Learning from Data to Predict
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#the-prediction-task">
   The Prediction task
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#prediction-tasks-in-social-sciences">
   Prediction tasks in social sciences
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#predictions-gone-wrong">
   Predictions gone wrong
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#supervised-learning">
   Supervised learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#research-problem-vaccine-hesitancy">
   Research problem: vaccine hesitancy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#data-understanding-society-covid-19">
   Data: Understanding Society COVID-19
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#defining-output-and-input-variables">
   Defining Output and Input variables
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#data-wrangling">
   Data wrangling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#overfitting-and-data-splitting">
   Overfitting and data splitting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#preprocessing-the-training-data-set">
   Preprocessing the training data set
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#unbalance-class-problem">
   Unbalance class problem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#train-models-on-training-data">
   Train models on training data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#model-evaluation-using-cross-validation">
   Model evaluation using Cross-validation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#testing-model-accuracy-on-new-data">
   Testing model accuracy on new data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#preprocessing-the-test-data-set">
   Preprocessing the test data set
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#predicting-vaccine-hesitancy">
   Predicting vaccine hesitancy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#model-evaluation-on-test-data">
   Model evaluation on test data
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Causal Inference
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="08_causal_inference.html">
   Introduction to Causal Inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_causal_inference.html#what-causes-what">
   What causes what?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_causal_inference.html#confoundingbasic-definitions">
   Confounding—basic definitions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_causal_inference.html#our-example-of-collider-bias">
   Our example of collider bias
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_causal_inference.html#drawing-causal-graphs">
   Drawing causal graphs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_causal_inference.html#statistical-models-in-python">
   Statistical Models in Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_causal_inference.html#collider-confounder">
   Collider confounder
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_causal_inference.html#additional-material">
   Additional material
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_causal_inference.html#gender-discrimination-and-collider-bias">
   Gender discrimination and collider bias
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_causal_inference.html#references">
   References
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Network Analysis
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="09_network_analysis.html">
   Network analysis with NetworkX
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_network_analysis.html#open-network-data-repositories">
   Open network data repositories
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_network_analysis.html#network-representations">
   Network representations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_network_analysis.html#creating-an-undirected-network">
   Creating an undirected network
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_network_analysis.html#computing-network-diagnostics">
   Computing network diagnostics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_network_analysis.html#assortative-mixing">
   Assortative mixing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_network_analysis.html#creating-a-directed-network">
   Creating a directed network
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_network_analysis.html#a-fun-examplestar-wars-network">
   A fun example—Star Wars network
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_network_analysis.html#global-network-diagnostics">
   Global network diagnostics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_network_analysis.html#meso-scale-network-diagnostics">
   Meso-scale network diagnostics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_network_analysis.html#local-network-diagnostics">
   Local network diagnostics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_network_analysis.html#references">
   References
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Data ethics
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="10_data_ethics.html">
   Data Ethics, Bias, and Fairness
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10_data_ethics.html#discussion-a-level-results-in-2020-england">
   Discussion: A-level results in 2020 England
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10_data_ethics.html#learning-resources-about-the-a-level-controversy">
   Learning resources about the A-level controversy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10_data_ethics.html#bias-and-fairness-in-data-science-systems">
   Bias and Fairness in Data Science Systems
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/05_data_exploration_and_visualisation.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/valdanchev/reproducible-data-science-python"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/valdanchev/reproducible-data-science-python/issues/new?title=Issue%20on%20page%20%2Fnotebooks/05_data_exploration_and_visualisation.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/valdanchev/reproducible-data-science-python/master?urlpath=tree/notebooks/05_data_exploration_and_visualisation.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Exploratory Data Analysis and Visualisation
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#learning-resources">
   Learning resources
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#addressing-simple-questions-via-python-eda">
   Addressing simple questions via Python EDA
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#importing-libraries">
     Importing libraries
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loading-and-processing-the-covid-19-mobility-data">
     Loading and processing the COVID-19 mobility data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#code-reuse-creating-your-own-functions">
   Code reuse: creating your own functions
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rq1-how-do-countries-differ-in-mobility-trends">
   RQ1: How do countries differ in mobility trends?
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-visualisation-with-seaborn">
   Data visualisation with Seaborn
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#changing-figure-appearance">
   Changing figure appearance
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#wide-and-long-data-format">
   Wide and long data format
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#multi-plot-visualisations">
   Multi-plot visualisations
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#hands-on-exercise">
   Hands-on exercise
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rq2-how-do-mobility-trends-change-over-time">
   RQ2: How do mobility trends change over time?
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualising-time-series-data">
   Visualising time series data
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bootstrapping-for-inference">
   Bootstrapping for inference
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rq3-how-have-mobility-trends-differed-across-uk-lockdowns">
   RQ3: How have mobility trends differed across UK lockdowns?
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualising-lockdowns-mobility-as-barplots">
   Visualising lockdowns’ mobility as barplots
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#discussion-activity">
     Discussion activity
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rq4-how-have-mobility-trends-differed-across-uk-counties-during-the-third-lockdown">
   RQ4: How have mobility trends differed across UK counties during the third lockdown?
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   Multi-plot visualisations
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#split-apply-combine">
   Split-apply-combine
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summarising-data-by-groups">
   Summarising data by groups
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rq5-how-do-mobility-categories-relate-to-each-other">
   RQ5: How do mobility categories relate to each other?
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualising-distributions">
   Visualising distributions
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plotting-pairwise-relationships">
   Plotting pairwise relationships
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#interpreting-pairwise-relationships">
     Interpreting pairwise relationships
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rq6-how-correlated-are-mobility-categories-across-uk-counties">
   RQ6: How correlated are mobility categories across UK counties?
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualising-correlation">
   Visualising correlation
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualising-linear-regression">
   Visualising linear regression
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#recording-dependencies">
   Recording dependencies
  </a>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="exploratory-data-analysis-and-visualisation">
<h1>Exploratory Data Analysis and Visualisation<a class="headerlink" href="#exploratory-data-analysis-and-visualisation" title="Permalink to this headline">¶</a></h1>
<p>The term Exploratory Data Analysis (EDA) was introduced by John Tukey in his book of the same title published in 1977. It is an approach of data analysis in which you employ a number of simple quantitative techniques (for example, descriptive statistics like the mean and the standard deviation) and visualisation to explore features of the data with an <a class="reference external" href="https://link.springer.com/referenceworkentry/10.1007%2F978-0-387-32833-1_136">‘open mind’</a>, before any particular statistical assumptions and models are applied to the data.</p>
<blockquote>
<div><p>“‘Exploratory data analysis’ is an attitude, a state of flexibility, a willingness to look for those things that we believe are not there, as well as those we believe to be there.” — John Tukey, 1977</p>
</div></blockquote>
<p>EDA can be seen as a paradigm of data analysis emphasising the ‘flexibility’ of data exploration and visualisation and the ability of a researcher to adapt to the ‘clues’ the data may reveal. Note that EDA is performed before data modelling. EDA is therefore different from any data exploration after the outputs from initial modelling are known, which is typically not regarded as a good research practice, unless openly reported. Such post-modelling exploration would likely motivate additional tests that are arbitrary yet could produce positive and statistically significant results (See Simmons, Nelson, and Simonsohn, <a class="reference external" href="https://doi.org/10.1177/0956797611417632">2011</a>).</p>
<p>In this lab, we will explore and visualise various features and patterns in the mobility trends data using the Python libraries <code class="docutils literal notranslate"><span class="pre">pandas</span></code> for data analysis and <code class="docutils literal notranslate"><span class="pre">SciPy</span></code> and <code class="docutils literal notranslate"><span class="pre">NumPy</span></code> for descriptive statistics and simple modelling. We will introduce the library <code class="docutils literal notranslate"><span class="pre">Seaborn</span></code> for data visualisation. <a class="reference external" href="https://seaborn.pydata.org/index.html"><code class="docutils literal notranslate"><span class="pre">Seaborn</span></code></a> is a Python data visualisation library built on top of <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>. It provides an interface for drawing attractive and informative statistical graphics.</p>
<p>We formulate simple research questions (RQ) and employ EDA to shed light on features of data that can help us address those research questions. We will perform various visualizations to communicate quantitative features, patterns, and longitudinal trends in our data. We will discuss good research practices related to EDA and visualisation.</p>
</div>
<div class="section" id="learning-resources">
<h1>Learning resources<a class="headerlink" href="#learning-resources" title="Permalink to this headline">¶</a></h1>
<p><i class="fas fa-book"></i> Sam Lau, Joey Gonzalez, and Deb Nolan. <a class="reference external" href="https://www.textbook.ds100.org/ch/11/viz_intro.html">10.4. Visualization Principles</a>. In <a class="reference external" href="https://www.textbook.ds100.org/intro.html"><em>Principles and Techniques of Data Science</em></a>.</p>
<p><i class="fas fa-scroll"></i> Kieran Healy and James Moody. <a class="reference external" href="https://kieranhealy.org/files/papers/data-visualization.pdf">Data Visualization in Sociology</a>. <em>Annual Review of Sociology</em>.</p>
<p><i class="fas fa-play-circle"></i> <a class="reference external" href="https://youtu.be/9pNWVMxaFuM">Misleading Axes</a> and <a class="reference external" href="https://youtu.be/zAg1wsYfwsM">Manipulating Bin Sizes</a>, part of the course <a class="reference external" href="https://www.callingbullshit.org">Calling Bullshit</a> by Carl T. Bergstrom and Jevin West</p>
<p><i class="fas fa-play-circle"></i> <i class="fas fa-code"></i> <a class="reference external" href="https://www.youtube.com/watch?v=5rNu16O3YNE">Introduction to Data Processing in Python with Pandas</a>, SciPy 2019 Tutorial by Daniel Chen (The visualisation library <code class="docutils literal notranslate"><span class="pre">Seaborn</span></code> is covered in the video between 2:15 and 2:45)</p>
</div>
<div class="section" id="addressing-simple-questions-via-python-eda">
<h1>Addressing simple questions via Python EDA<a class="headerlink" href="#addressing-simple-questions-via-python-eda" title="Permalink to this headline">¶</a></h1>
<div class="section" id="importing-libraries">
<h2>Importing libraries<a class="headerlink" href="#importing-libraries" title="Permalink to this headline">¶</a></h2>
<p>We first import Python libraries for exploratory data analysis and visualisation. We also import the libraries <code class="docutils literal notranslate"><span class="pre">Statsmodels</span></code> and <code class="docutils literal notranslate"><span class="pre">SciPy</span></code> for statistical and scientific computing, which we will use to fit simple statistical models after our data explorations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import Python libraries for visualisation and data analysis</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">()</span>  <span class="c1"># Apply the default Seaborn theme</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># Suppress warnings to avoid potential confusion</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="c1"># Libraries for statistical and scientific computing</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="loading-and-processing-the-covid-19-mobility-data">
<h2>Loading and processing the COVID-19 mobility data<a class="headerlink" href="#loading-and-processing-the-covid-19-mobility-data" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the Covid-19 Google Community Mobility Reports</span>
<span class="c1"># By default, Pandas will read the date column as string, so we use parse_dates to</span>
<span class="c1"># convert the string into datetimes we will use for time series plots.</span>
<span class="n">mobility_trends_complete</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">&quot;https://www.gstatic.com/covid19/mobility/Global_Mobility_Report.csv&quot;</span><span class="p">,</span>
    <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">],</span>
<span class="p">)</span>

<span class="c1"># The Community Mobility Reports is updated daily, approaching</span>
<span class="c1"># 10 million rows as of April 2022. To make data analysis more</span>
<span class="c1"># manageable, we select a subset of the dataset until 30 June 2021</span>
<span class="c1"># (15 February 2020 is the first time point in the data set).</span>
<span class="n">mobility_trends</span> <span class="o">=</span> <span class="n">mobility_trends_complete</span><span class="p">[</span>
    <span class="n">mobility_trends_complete</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;2020-02-15&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;2021-06-30&quot;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">]</span>

<span class="c1"># Rename (i.e., shorten the labels) the six mobility categories</span>
<span class="n">mobility_trends</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;retail_and_recreation_percent_change_from_baseline&quot;</span><span class="p">:</span> <span class="s2">&quot;Retail_Recreation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;grocery_and_pharmacy_percent_change_from_baseline&quot;</span><span class="p">:</span> <span class="s2">&quot;Grocery_Pharmacy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;parks_percent_change_from_baseline&quot;</span><span class="p">:</span> <span class="s2">&quot;Parks&quot;</span><span class="p">,</span>
        <span class="s2">&quot;transit_stations_percent_change_from_baseline&quot;</span><span class="p">:</span> <span class="s2">&quot;Transit_stations&quot;</span><span class="p">,</span>
        <span class="s2">&quot;workplaces_percent_change_from_baseline&quot;</span><span class="p">:</span> <span class="s2">&quot;Workplaces&quot;</span><span class="p">,</span>
        <span class="s2">&quot;residential_percent_change_from_baseline&quot;</span><span class="p">:</span> <span class="s2">&quot;Residential&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">mobility_trends</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="code-reuse-creating-your-own-functions">
<h1>Code reuse: creating your own functions<a class="headerlink" href="#code-reuse-creating-your-own-functions" title="Permalink to this headline">¶</a></h1>
<p>We will need to pre-process the mobility data in subsequent chapters as well. Instead of typing (or copying and pasting) the lines of code for pre-processing multiple times, which would likely introduce errors, it is a good practice to define your own function that stores your code. You can then call that function when you need to reuse the code. Below we define two functions called <code class="docutils literal notranslate"><span class="pre">subperiod_mobility_trends</span></code> and <code class="docutils literal notranslate"><span class="pre">rename_mobility_trends</span></code> which we will use in the next lesson to process the mobility data.</p>
<p>Let’s use the <code class="docutils literal notranslate"><span class="pre">subperiod_mobility_trends</span></code> as an example. As every function (see the book <a class="reference external" href="https://github.com/realpython/python-basics-exercises">Python Basics: A Practical Introduction to Python 3</a>), <code class="docutils literal notranslate"><span class="pre">subperiod_mobility_trends</span></code> has three parts:</p>
<ul class="simple">
<li><p>function signature</p></li>
<li><p>docstring (short for documentation strings)</p></li>
<li><p>function body</p></li>
</ul>
<p>Let’s describe each of these three parts.</p>
<p>The function signature has the following four components:</p>
<ol class="simple">
<li><p>the <code class="docutils literal notranslate"><span class="pre">def</span></code> keyword (short for define)</p></li>
<li><p>the function name, <code class="docutils literal notranslate"><span class="pre">subperiod_mobility_trends</span></code></p></li>
<li><p>the list of parameters, <code class="docutils literal notranslate"><span class="pre">data</span></code>, <code class="docutils literal notranslate"><span class="pre">start_date</span></code>, and <code class="docutils literal notranslate"><span class="pre">end_date</span></code> (these are placeholders for the actual data and start and end dates we will provide when we call the function)</p></li>
<li><p>A colon (:) at the end of the line of code.</p></li>
</ol>
<p>The docstring is placed immediately after the function definition (the function signature), enclosed in triple-double quotes (“””). The purpose of the dosctrings is to document the code and to state its main purpose.</p>
<p>The function body consists of the code that runs when you call the function. For example, the function body for <code class="docutils literal notranslate"><span class="pre">subperiod_mobility_trends</span></code> consists of a block of code that selects a subset of the mobility data for a period of time with pre-specified start date and end date.</p>
<p>Let’s define our function for selecting mobility trends for a subperiod and save the function as <code class="docutils literal notranslate"><span class="pre">subperiod_mobility_trends.py</span></code> so that we can reuse the code in subsequent notebooks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">subperiod_mobility_trends</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add your mobility data in `data`.</span>

<span class="sd">    This function selects a subperiod of the mobility data based on prespecified start data and end date.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mobility_trends</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">))</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">mobility_trends</span>


<span class="k">def</span> <span class="nf">rename_mobility_trends</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function renames the column headings of the six mobility categories.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mobility_trends_renamed</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;retail_and_recreation_percent_change_from_baseline&quot;</span><span class="p">:</span> <span class="s2">&quot;Retail_Recreation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;grocery_and_pharmacy_percent_change_from_baseline&quot;</span><span class="p">:</span> <span class="s2">&quot;Grocery_Pharmacy&quot;</span><span class="p">,</span>
            <span class="s2">&quot;parks_percent_change_from_baseline&quot;</span><span class="p">:</span> <span class="s2">&quot;Parks&quot;</span><span class="p">,</span>
            <span class="s2">&quot;transit_stations_percent_change_from_baseline&quot;</span><span class="p">:</span> <span class="s2">&quot;Transit_stations&quot;</span><span class="p">,</span>
            <span class="s2">&quot;workplaces_percent_change_from_baseline&quot;</span><span class="p">:</span> <span class="s2">&quot;Workplaces&quot;</span><span class="p">,</span>
            <span class="s2">&quot;residential_percent_change_from_baseline&quot;</span><span class="p">:</span> <span class="s2">&quot;Residential&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">mobility_trends_renamed</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s call our functions. We pass as input to the function <code class="docutils literal notranslate"><span class="pre">subperiod_mobility_trends()</span></code> the complete Community Mobility Reports data set  we already loaded as <code class="docutils literal notranslate"><span class="pre">mobility_trends_complete</span></code>. We then pass the output as input to the function <code class="docutils literal notranslate"><span class="pre">rename_mobility_trends()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends</span> <span class="o">=</span> <span class="n">subperiod_mobility_trends</span><span class="p">(</span>
    <span class="n">mobility_trends_complete</span><span class="p">,</span> <span class="s2">&quot;2020-02-15&quot;</span><span class="p">,</span> <span class="s2">&quot;2021-06-30&quot;</span>
<span class="p">)</span>

<span class="n">mobility_trends</span> <span class="o">=</span> <span class="n">rename_mobility_trends</span><span class="p">(</span><span class="n">mobility_trends</span><span class="p">)</span>

<span class="n">mobility_trends</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>country_region_code</th>
      <th>country_region</th>
      <th>sub_region_1</th>
      <th>sub_region_2</th>
      <th>metro_area</th>
      <th>iso_3166_2_code</th>
      <th>census_fips_code</th>
      <th>place_id</th>
      <th>date</th>
      <th>Retail_Recreation</th>
      <th>Grocery_Pharmacy</th>
      <th>Parks</th>
      <th>Transit_stations</th>
      <th>Workplaces</th>
      <th>Residential</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AE</td>
      <td>United Arab Emirates</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ChIJvRKrsd9IXj4RpwoIwFYv0zM</td>
      <td>2020-02-15</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AE</td>
      <td>United Arab Emirates</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ChIJvRKrsd9IXj4RpwoIwFYv0zM</td>
      <td>2020-02-16</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AE</td>
      <td>United Arab Emirates</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ChIJvRKrsd9IXj4RpwoIwFYv0zM</td>
      <td>2020-02-17</td>
      <td>-1.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AE</td>
      <td>United Arab Emirates</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ChIJvRKrsd9IXj4RpwoIwFYv0zM</td>
      <td>2020-02-18</td>
      <td>-2.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AE</td>
      <td>United Arab Emirates</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ChIJvRKrsd9IXj4RpwoIwFYv0zM</td>
      <td>2020-02-19</td>
      <td>-2.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>-1.0</td>
      <td>2.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>9709045</th>
      <td>ZW</td>
      <td>Zimbabwe</td>
      <td>Midlands Province</td>
      <td>Kwekwe</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ChIJRcIZ3-FJNBkRRsj55IcLpfU</td>
      <td>2021-06-24</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>7.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>9709046</th>
      <td>ZW</td>
      <td>Zimbabwe</td>
      <td>Midlands Province</td>
      <td>Kwekwe</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ChIJRcIZ3-FJNBkRRsj55IcLpfU</td>
      <td>2021-06-25</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>13.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>9709047</th>
      <td>ZW</td>
      <td>Zimbabwe</td>
      <td>Midlands Province</td>
      <td>Kwekwe</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ChIJRcIZ3-FJNBkRRsj55IcLpfU</td>
      <td>2021-06-28</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-3.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>9709048</th>
      <td>ZW</td>
      <td>Zimbabwe</td>
      <td>Midlands Province</td>
      <td>Kwekwe</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ChIJRcIZ3-FJNBkRRsj55IcLpfU</td>
      <td>2021-06-29</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>12.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>9709049</th>
      <td>ZW</td>
      <td>Zimbabwe</td>
      <td>Midlands Province</td>
      <td>Kwekwe</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ChIJRcIZ3-FJNBkRRsj55IcLpfU</td>
      <td>2021-06-30</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>5970596 rows × 15 columns</p>
</div></div></div>
</div>
<p>As expected, the two functions generate the same output as the code in section <em>Loading and processing the COVID-19 mobility data</em> above.</p>
<p>As a final step, we save the functions as a script file called <code class="docutils literal notranslate"><span class="pre">preprocess_mobility_trends.py</span></code> so that we can load and use the functions in other notebooks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> preprocess_mobility_trends.py


<span class="k">def</span> <span class="nf">subperiod_mobility_trends</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add your mobility data in `data`.</span>

<span class="sd">    This function selects a subperiod of the mobility data based on prespecified start data and end date.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mobility_trends</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">))</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">mobility_trends</span>


<span class="k">def</span> <span class="nf">rename_mobility_trends</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function renames the column headings of the six mobility categories.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mobility_trends_renamed</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;retail_and_recreation_percent_change_from_baseline&quot;</span><span class="p">:</span> <span class="s2">&quot;Retail_Recreation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;grocery_and_pharmacy_percent_change_from_baseline&quot;</span><span class="p">:</span> <span class="s2">&quot;Grocery_Pharmacy&quot;</span><span class="p">,</span>
            <span class="s2">&quot;parks_percent_change_from_baseline&quot;</span><span class="p">:</span> <span class="s2">&quot;Parks&quot;</span><span class="p">,</span>
            <span class="s2">&quot;transit_stations_percent_change_from_baseline&quot;</span><span class="p">:</span> <span class="s2">&quot;Transit_stations&quot;</span><span class="p">,</span>
            <span class="s2">&quot;workplaces_percent_change_from_baseline&quot;</span><span class="p">:</span> <span class="s2">&quot;Workplaces&quot;</span><span class="p">,</span>
            <span class="s2">&quot;residential_percent_change_from_baseline&quot;</span><span class="p">:</span> <span class="s2">&quot;Residential&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">mobility_trends_renamed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing preprocess_mobility_trends.py
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="rq1-how-do-countries-differ-in-mobility-trends">
<h1>RQ1: How do countries differ in mobility trends?<a class="headerlink" href="#rq1-how-do-countries-differ-in-mobility-trends" title="Permalink to this headline">¶</a></h1>
<p>To begin to analyse differences in mobility trends across countries, we first need to determine how countries are labeled in the data set, which we could do by typing</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends</span><span class="o">.</span><span class="n">country_region</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;United Arab Emirates&#39;, &#39;Afghanistan&#39;, &#39;Antigua and Barbuda&#39;,
       &#39;Angola&#39;, &#39;Argentina&#39;, &#39;Austria&#39;, &#39;Australia&#39;, &#39;Aruba&#39;,
       &#39;Bosnia and Herzegovina&#39;, &#39;Barbados&#39;, &#39;Bangladesh&#39;, &#39;Belgium&#39;,
       &#39;Burkina Faso&#39;, &#39;Bulgaria&#39;, &#39;Bahrain&#39;, &#39;Benin&#39;, &#39;Bolivia&#39;,
       &#39;Brazil&#39;, &#39;The Bahamas&#39;, &#39;Botswana&#39;, &#39;Belarus&#39;, &#39;Belize&#39;, &#39;Canada&#39;,
       &#39;Switzerland&#39;, &quot;Côte d&#39;Ivoire&quot;, &#39;Chile&#39;, &#39;Cameroon&#39;, &#39;Colombia&#39;,
       &#39;Costa Rica&#39;, &#39;Cape Verde&#39;, &#39;Czechia&#39;, &#39;Germany&#39;, &#39;Denmark&#39;,
       &#39;Dominican Republic&#39;, &#39;Ecuador&#39;, &#39;Estonia&#39;, &#39;Egypt&#39;, &#39;Spain&#39;,
       &#39;Finland&#39;, &#39;Fiji&#39;, &#39;France&#39;, &#39;Gabon&#39;, &#39;United Kingdom&#39;, &#39;Georgia&#39;,
       &#39;Ghana&#39;, &#39;Greece&#39;, &#39;Guatemala&#39;, &#39;Guinea-Bissau&#39;, &#39;Hong Kong&#39;,
       &#39;Honduras&#39;, &#39;Croatia&#39;, &#39;Haiti&#39;, &#39;Hungary&#39;, &#39;Indonesia&#39;, &#39;Ireland&#39;,
       &#39;Israel&#39;, &#39;India&#39;, &#39;Iraq&#39;, &#39;Italy&#39;, &#39;Jamaica&#39;, &#39;Jordan&#39;, &#39;Japan&#39;,
       &#39;Kenya&#39;, &#39;Kyrgyzstan&#39;, &#39;Cambodia&#39;, &#39;South Korea&#39;, &#39;Kuwait&#39;,
       &#39;Kazakhstan&#39;, &#39;Laos&#39;, &#39;Lebanon&#39;, &#39;Liechtenstein&#39;, &#39;Sri Lanka&#39;,
       &#39;Lithuania&#39;, &#39;Luxembourg&#39;, &#39;Latvia&#39;, &#39;Libya&#39;, &#39;Morocco&#39;, &#39;Moldova&#39;,
       &#39;North Macedonia&#39;, &#39;Mali&#39;, &#39;Myanmar (Burma)&#39;, &#39;Mongolia&#39;, &#39;Malta&#39;,
       &#39;Mauritius&#39;, &#39;Mexico&#39;, &#39;Malaysia&#39;, &#39;Mozambique&#39;, &#39;Namibia&#39;,
       &#39;Niger&#39;, &#39;Nigeria&#39;, &#39;Nicaragua&#39;, &#39;Netherlands&#39;, &#39;Norway&#39;, &#39;Nepal&#39;,
       &#39;New Zealand&#39;, &#39;Oman&#39;, &#39;Panama&#39;, &#39;Peru&#39;, &#39;Papua New Guinea&#39;,
       &#39;Philippines&#39;, &#39;Pakistan&#39;, &#39;Poland&#39;, &#39;Puerto Rico&#39;, &#39;Portugal&#39;,
       &#39;Paraguay&#39;, &#39;Qatar&#39;, &#39;Réunion&#39;, &#39;Romania&#39;, &#39;Serbia&#39;, &#39;Russia&#39;,
       &#39;Rwanda&#39;, &#39;Saudi Arabia&#39;, &#39;Sweden&#39;, &#39;Singapore&#39;, &#39;Slovenia&#39;,
       &#39;Slovakia&#39;, &#39;Senegal&#39;, &#39;El Salvador&#39;, &#39;Togo&#39;, &#39;Thailand&#39;,
       &#39;Tajikistan&#39;, &#39;Turkey&#39;, &#39;Trinidad and Tobago&#39;, &#39;Taiwan&#39;,
       &#39;Tanzania&#39;, &#39;Ukraine&#39;, &#39;Uganda&#39;, &#39;United States&#39;, &#39;Uruguay&#39;,
       &#39;Venezuela&#39;, &#39;Vietnam&#39;, &#39;Yemen&#39;, &#39;South Africa&#39;, &#39;Zambia&#39;,
       &#39;Zimbabwe&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p>We then select data about six countries of interest using the <code class="docutils literal notranslate"><span class="pre">isin()</span></code> method and passing a list <code class="docutils literal notranslate"><span class="pre">[]</span></code> of our six countries as an argument.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Access data about multiple countries</span>

<span class="n">mobility_trends_countries</span> <span class="o">=</span> <span class="n">mobility_trends</span><span class="p">[</span>
    <span class="n">mobility_trends</span><span class="p">[</span><span class="s2">&quot;country_region&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;United Kingdom&quot;</span><span class="p">,</span> <span class="s2">&quot;Italy&quot;</span><span class="p">,</span> <span class="s2">&quot;France&quot;</span><span class="p">,</span> <span class="s2">&quot;Germany&quot;</span><span class="p">,</span> <span class="s2">&quot;Sweden&quot;</span><span class="p">,</span> <span class="s2">&quot;Spain&quot;</span><span class="p">]</span>
    <span class="p">)</span>
<span class="p">]</span>

<span class="n">mobility_trends_countries</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>country_region_code</th>
      <th>country_region</th>
      <th>sub_region_1</th>
      <th>sub_region_2</th>
      <th>metro_area</th>
      <th>iso_3166_2_code</th>
      <th>census_fips_code</th>
      <th>place_id</th>
      <th>date</th>
      <th>Retail_Recreation</th>
      <th>Grocery_Pharmacy</th>
      <th>Parks</th>
      <th>Transit_stations</th>
      <th>Workplaces</th>
      <th>Residential</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3114174</th>
      <td>DE</td>
      <td>Germany</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ChIJa76xwh5ymkcRW-WRjmtd6HU</td>
      <td>2020-02-15</td>
      <td>6.0</td>
      <td>1.0</td>
      <td>45.0</td>
      <td>10.0</td>
      <td>0.0</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>3114175</th>
      <td>DE</td>
      <td>Germany</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ChIJa76xwh5ymkcRW-WRjmtd6HU</td>
      <td>2020-02-16</td>
      <td>7.0</td>
      <td>10.0</td>
      <td>9.0</td>
      <td>6.0</td>
      <td>-1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3114176</th>
      <td>DE</td>
      <td>Germany</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ChIJa76xwh5ymkcRW-WRjmtd6HU</td>
      <td>2020-02-17</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>7.0</td>
      <td>1.0</td>
      <td>-2.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3114177</th>
      <td>DE</td>
      <td>Germany</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ChIJa76xwh5ymkcRW-WRjmtd6HU</td>
      <td>2020-02-18</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>10.0</td>
      <td>1.0</td>
      <td>-1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3114178</th>
      <td>DE</td>
      <td>Germany</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ChIJa76xwh5ymkcRW-WRjmtd6HU</td>
      <td>2020-02-19</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>6.0</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="data-visualisation-with-seaborn">
<h1>Data visualisation with Seaborn<a class="headerlink" href="#data-visualisation-with-seaborn" title="Permalink to this headline">¶</a></h1>
<p>Let’s first summarise one mobility category — for example, workplaces mobility — for the six selected countries using a box plot. In <code class="docutils literal notranslate"><span class="pre">seaborn</span></code>, we use the function <a class="reference external" href="https://seaborn.pydata.org/generated/seaborn.catplot.html"><code class="docutils literal notranslate"><span class="pre">catplot</span></code></a> which displays the relationship between a numerical and one or more categorical variables using several visual representations, including bar plot, box plot, and violin plot.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">catplot</span></code> function has many parameters. You can access them by typing <code class="docutils literal notranslate"><span class="pre">sns.catplot?</span></code> in a code cell. These are the parameters we will need for our first plot:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">x</span></code> — Categorical variable, in our case the variable “country_region” containing the labels of the six countries</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y</span></code> — Numerical variable, in our case the variable “workplaces_percent_change_from_baseline”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code> — <code class="docutils literal notranslate"><span class="pre">pandas</span></code> DataFrame</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kind</span></code> — The kind of plot to draw. Options are: “strip”, “swarm”, “box”, “violin”, “boxen”, “point”, “bar”, or “count”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">height</span></code> — Height (in inches) of the plot</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aspect</span></code> — Aspect * height gives the width (in inches) of the plot</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Box plot of workplaces mobility trends in selected countries</span>

<span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;country_region&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Workplaces&quot;</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;box&quot;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">mobility_trends_countries</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">aspect</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/05_data_exploration_and_visualisation_18_0.png" src="../_images/05_data_exploration_and_visualisation_18_0.png" />
</div>
</div>
</div>
<div class="section" id="changing-figure-appearance">
<h1>Changing figure appearance<a class="headerlink" href="#changing-figure-appearance" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">Seaborn</span></code> provides a range of capabilities to change figure appearance. For example, the figure below set a theme that controls color, font, and other features. The <code class="docutils literal notranslate"><span class="pre">set_theme()</span></code> function applies globally to the entire notebook so you do not need to execute again the function unless you want to change the theme. We also change the y and x axes labels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Control the scale of plot elements, font</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="s2">&quot;notebook&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;darkgrid&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;pastel&quot;</span><span class="p">,</span> <span class="n">font_scale</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>

<span class="n">grid</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;country_region&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Workplaces&quot;</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;box&quot;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">mobility_trends_countries</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">aspect</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Change the labels of the two axes</span>
<span class="n">grid</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Workplaces mobility change from baseline (%)&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/05_data_exploration_and_visualisation_20_0.png" src="../_images/05_data_exploration_and_visualisation_20_0.png" />
</div>
</div>
<p>You can access information about the <code class="docutils literal notranslate"><span class="pre">catplot</span></code> function by typing <code class="docutils literal notranslate"><span class="pre">help(sns.catplot)</span></code> or <code class="docutils literal notranslate"><span class="pre">sns.catplot?</span></code></p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>sns.catplot<span class="o">?</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">Signature:</span>
sns<span class=" -Color -Color-Blue">.</span>catplot<span class=" -Color -Color-Blue">(</span>
    <span class=" -Color -Color-Blue">*,</span>
    x<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">None</span><span class=" -Color -Color-Blue">,</span>
    y<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">None</span><span class=" -Color -Color-Blue">,</span>
    hue<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">None</span><span class=" -Color -Color-Blue">,</span>
    data<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">None</span><span class=" -Color -Color-Blue">,</span>
    row<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">None</span><span class=" -Color -Color-Blue">,</span>
    col<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">None</span><span class=" -Color -Color-Blue">,</span>
    col_wrap<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">None</span><span class=" -Color -Color-Blue">,</span>
    estimator<span class=" -Color -Color-Blue">=&lt;</span>function mean at <span class=" -Color -Color-Cyan">0x7fd028186a60</span><span class=" -Color -Color-Blue">&gt;,</span>
    ci<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Cyan">95</span><span class=" -Color -Color-Blue">,</span>
    n_boot<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Cyan">1000</span><span class=" -Color -Color-Blue">,</span>
    units<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">None</span><span class=" -Color -Color-Blue">,</span>
    seed<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">None</span><span class=" -Color -Color-Blue">,</span>
    order<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">None</span><span class=" -Color -Color-Blue">,</span>
    hue_order<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">None</span><span class=" -Color -Color-Blue">,</span>
    row_order<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">None</span><span class=" -Color -Color-Blue">,</span>
    col_order<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">None</span><span class=" -Color -Color-Blue">,</span>
    kind<span class=" -Color -Color-Blue">=&#39;strip&#39;,</span>
    height<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Cyan">5</span><span class=" -Color -Color-Blue">,</span>
    aspect<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">,</span>
    orient<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">None</span><span class=" -Color -Color-Blue">,</span>
    color<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">None</span><span class=" -Color -Color-Blue">,</span>
    palette<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">None</span><span class=" -Color -Color-Blue">,</span>
    legend<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">True</span><span class=" -Color -Color-Blue">,</span>
    legend_out<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">True</span><span class=" -Color -Color-Blue">,</span>
    sharex<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">True</span><span class=" -Color -Color-Blue">,</span>
    sharey<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">True</span><span class=" -Color -Color-Blue">,</span>
    margin_titles<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">False</span><span class=" -Color -Color-Blue">,</span>
    facet_kws<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">None</span><span class=" -Color -Color-Blue">,</span>
    <span class=" -Color -Color-Blue">**</span>kwargs<span class=" -Color -Color-Blue">,</span>
<span class=" -Color -Color-Blue">)</span>
<span class=" -Color -Color-Red">Docstring:</span>
Figure-level interface for drawing categorical plots onto a FacetGrid.

This function provides access to several axes-level functions that
show the relationship between a numerical and one or more categorical
variables using one of several visual representations. The ``kind``
parameter selects the underlying axes-level function to use:

Categorical scatterplots:

- :func:`stripplot` (with ``kind=&quot;strip&quot;``; the default)
- :func:`swarmplot` (with ``kind=&quot;swarm&quot;``)

Categorical distribution plots:

- :func:`boxplot` (with ``kind=&quot;box&quot;``)
- :func:`violinplot` (with ``kind=&quot;violin&quot;``)
- :func:`boxenplot` (with ``kind=&quot;boxen&quot;``)

Categorical estimate plots:

- :func:`pointplot` (with ``kind=&quot;point&quot;``)
- :func:`barplot` (with ``kind=&quot;bar&quot;``)
- :func:`countplot` (with ``kind=&quot;count&quot;``)

Extra keyword arguments are passed to the underlying function, so you
should refer to the documentation for each to see kind-specific options.

Note that unlike when using the axes-level functions directly, data must be
passed in a long-form DataFrame with variables specified by passing strings
to ``x``, ``y``, ``hue``, etc.

As in the case with the underlying plot functions, if variables have a
``categorical`` data type, the levels of the categorical variables, and
their order will be inferred from the objects. Otherwise you may have to
use alter the dataframe sorting or use the function parameters (``orient``,
``order``, ``hue_order``, etc.) to set up the plot correctly.

This function always treats one of the variables as categorical and
draws data at ordinal positions (0, 1, ... n) on the relevant axis, even
when the data has a numeric or date type.

See the :ref:`tutorial &lt;categorical_tutorial&gt;` for more information.    

After plotting, the :class:`FacetGrid` with the plot is returned and can
be used directly to tweak supporting plot details or add other layers.

Parameters
----------
x, y, hue : names of variables in ``data``
    Inputs for plotting long-form data. See examples for interpretation.        
data : DataFrame
    Long-form (tidy) dataset for plotting. Each column should correspond
    to a variable, and each row should correspond to an observation.    
row, col : names of variables in ``data``, optional
    Categorical variables that will determine the faceting of the grid.
col_wrap : int
    &quot;Wrap&quot; the column variable at this width, so that the column facets
    span multiple rows. Incompatible with a ``row`` facet.    
estimator : callable that maps vector -&gt; scalar, optional
    Statistical function to estimate within each categorical bin.
ci : float or &quot;sd&quot; or None, optional
    Size of confidence intervals to draw around estimated values.  If
    &quot;sd&quot;, skip bootstrapping and draw the standard deviation of the
    observations. If ``None``, no bootstrapping will be performed, and
    error bars will not be drawn.
n_boot : int, optional
    Number of bootstrap iterations to use when computing confidence
    intervals.
units : name of variable in ``data`` or vector data, optional
    Identifier of sampling units, which will be used to perform a
    multilevel bootstrap and account for repeated measures design.
seed : int, numpy.random.Generator, or numpy.random.RandomState, optional
    Seed or random number generator for reproducible bootstrapping.    
order, hue_order : lists of strings, optional
    Order to plot the categorical levels in, otherwise the levels are
    inferred from the data objects.        
row_order, col_order : lists of strings, optional
    Order to organize the rows and/or columns of the grid in, otherwise the
    orders are inferred from the data objects.
kind : str, optional
    The kind of plot to draw, corresponds to the name of a categorical
    axes-level plotting function. Options are: &quot;strip&quot;, &quot;swarm&quot;, &quot;box&quot;, &quot;violin&quot;,
    &quot;boxen&quot;, &quot;point&quot;, &quot;bar&quot;, or &quot;count&quot;.
height : scalar
    Height (in inches) of each facet. See also: ``aspect``.    
aspect : scalar
    Aspect ratio of each facet, so that ``aspect * height`` gives the width
    of each facet in inches.    
orient : &quot;v&quot; | &quot;h&quot;, optional
    Orientation of the plot (vertical or horizontal). This is usually
    inferred based on the type of the input variables, but it can be used
    to resolve ambiguity when both `x` and `y` are numeric or when
    plotting wide-form data.    
color : matplotlib color, optional
    Color for all of the elements, or seed for a gradient palette.    
palette : palette name, list, or dict
    Colors to use for the different levels of the ``hue`` variable. Should
    be something that can be interpreted by :func:`color_palette`, or a
    dictionary mapping hue levels to matplotlib colors.    
legend : bool, optional
    If ``True`` and there is a ``hue`` variable, draw a legend on the plot.
legend_out : bool
    If ``True``, the figure size will be extended, and the legend will be
    drawn outside the plot on the center right.    
share{x,y} : bool, &#39;col&#39;, or &#39;row&#39; optional
    If true, the facets will share y axes across columns and/or x axes
    across rows.    
margin_titles : bool
    If ``True``, the titles for the row variable are drawn to the right of
    the last column. This option is experimental and may not work in all
    cases.    
facet_kws : dict, optional
    Dictionary of other keyword arguments to pass to :class:`FacetGrid`.
kwargs : key, value pairings
    Other keyword arguments are passed through to the underlying plotting
    function.

Returns
-------
g : :class:`FacetGrid`
    Returns the :class:`FacetGrid` object with the plot on it for further
    tweaking.

Examples
--------

Draw a single facet to use the :class:`FacetGrid` legend placement:

.. plot::
    :context: close-figs

    &gt;&gt;&gt; import seaborn as sns
    &gt;&gt;&gt; sns.set_theme(style=&quot;ticks&quot;)
    &gt;&gt;&gt; exercise = sns.load_dataset(&quot;exercise&quot;)
    &gt;&gt;&gt; g = sns.catplot(x=&quot;time&quot;, y=&quot;pulse&quot;, hue=&quot;kind&quot;, data=exercise)

Use a different plot kind to visualize the same data:

.. plot::
    :context: close-figs

    &gt;&gt;&gt; g = sns.catplot(x=&quot;time&quot;, y=&quot;pulse&quot;, hue=&quot;kind&quot;,
    ...                data=exercise, kind=&quot;violin&quot;)

Facet along the columns to show a third categorical variable:

.. plot::
    :context: close-figs

    &gt;&gt;&gt; g = sns.catplot(x=&quot;time&quot;, y=&quot;pulse&quot;, hue=&quot;kind&quot;,
    ...                 col=&quot;diet&quot;, data=exercise)

Use a different height and aspect ratio for the facets:

.. plot::
    :context: close-figs

    &gt;&gt;&gt; g = sns.catplot(x=&quot;time&quot;, y=&quot;pulse&quot;, hue=&quot;kind&quot;,
    ...                 col=&quot;diet&quot;, data=exercise,
    ...                 height=5, aspect=.8)

Make many column facets and wrap them into the rows of the grid:

.. plot::
    :context: close-figs

    &gt;&gt;&gt; titanic = sns.load_dataset(&quot;titanic&quot;)
    &gt;&gt;&gt; g = sns.catplot(x=&quot;alive&quot;, col=&quot;deck&quot;, col_wrap=4,
    ...                 data=titanic[titanic.deck.notnull()],
    ...                 kind=&quot;count&quot;, height=2.5, aspect=.8)

Plot horizontally and pass other keyword arguments to the plot function:

.. plot::
    :context: close-figs

    &gt;&gt;&gt; g = sns.catplot(x=&quot;age&quot;, y=&quot;embark_town&quot;,
    ...                 hue=&quot;sex&quot;, row=&quot;class&quot;,
    ...                 data=titanic[titanic.embark_town.notnull()],
    ...                 orient=&quot;h&quot;, height=2, aspect=3, palette=&quot;Set3&quot;,
    ...                 kind=&quot;violin&quot;, dodge=True, cut=0, bw=.2)

Use methods on the returned :class:`FacetGrid` to tweak the presentation:

.. plot::
    :context: close-figs

    &gt;&gt;&gt; g = sns.catplot(x=&quot;who&quot;, y=&quot;survived&quot;, col=&quot;class&quot;,
    ...                 data=titanic, saturation=.5,
    ...                 kind=&quot;bar&quot;, ci=None, aspect=.6)
    &gt;&gt;&gt; (g.set_axis_labels(&quot;&quot;, &quot;Survival Rate&quot;)
    ...   .set_xticklabels([&quot;Men&quot;, &quot;Women&quot;, &quot;Children&quot;])
    ...   .set_titles(&quot;{col_name} {col_var}&quot;)
    ...   .set(ylim=(0, 1))
    ...   .despine(left=True))  #doctest: +ELLIPSIS
    &lt;seaborn.axisgrid.FacetGrid object at 0x...&gt;
<span class=" -Color -Color-Red">File:</span>      ~/.local/lib/python3.8/site-packages/seaborn/categorical.py
<span class=" -Color -Color-Red">Type:</span>      function
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="wide-and-long-data-format">
<h1>Wide and long data format<a class="headerlink" href="#wide-and-long-data-format" title="Permalink to this headline">¶</a></h1>
<p>In the original data, each mobility category is a separate column, which is known as wide data format. Wide data format is easy to read but restricts us to plotting only one mobility category at a time (unless we employ a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop). We can plot all mobility categories simultaneously in <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> after we reshape our data from wide format to long format. Long data format will have one column for all six mobility categories and one column for the values of those categories.</p>
<p>Below is a Pandas schematic of wide (left) and long format data (right):</p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/reshaping.html">Reshaping data</a>
<img src="https://pandas.pydata.org/pandas-docs/stable/_images/reshaping_melt.png" title='Pandas DataFrame' width="600" height="300"/></p>
<p>Reshaping our mobility categories from wide to long format using the pandas <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.melt.html"><code class="docutils literal notranslate"><span class="pre">melt</span></code></a> function. The function transforms a DataFrame into a format where one or more columns are identifier variables (id_vars), while other columns (value_vars) are turned into a long format, returning columns, ‘variable’ and ‘value’. In our example, id_vars are<code class="docutils literal notranslate"><span class="pre">country_region</span></code> and <code class="docutils literal notranslate"><span class="pre">date</span></code>, and value_vars are the six mobility categories. The <code class="docutils literal notranslate"><span class="pre">melt</span></code> function takes the following parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> — your pandas DataFrame</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id_vars</span></code> — a list of identifier variables</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value_vars</span></code> — a list of variables to turn into long format</p></li>
</ul>
<p>The code below also removes NaN, standing for Not a Number, using the method <code class="docutils literal notranslate"><span class="pre">dropna()</span></code></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Instead of manually creating a list of all six column labels for the six mobility categories of interest, you can obtain the list by typing in</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends_countries</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span>
</pre></div>
</div>
<p>where the attribute <code class="docutils literal notranslate"><span class="pre">columns</span></code> returns the column labels of the DataFrame <code class="docutils literal notranslate"><span class="pre">mobility_trends_countries</span></code> and the indices in square brackets [9:15] specify the location of the mobility categories’ columns of interest. The command returns the labels in the following format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;retail_and_recreation_percent_change_from_baseline&#39;</span><span class="p">,</span>
       <span class="s1">&#39;grocery_and_pharmacy_percent_change_from_baseline&#39;</span><span class="p">,</span>
       <span class="s1">&#39;parks_percent_change_from_baseline&#39;</span><span class="p">,</span>
       <span class="s1">&#39;transit_stations_percent_change_from_baseline&#39;</span><span class="p">,</span>
       <span class="s1">&#39;workplaces_percent_change_from_baseline&#39;</span><span class="p">,</span>
       <span class="s1">&#39;residential_percent_change_from_baseline&#39;</span><span class="p">],</span>
      <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># From wide to long format using the function melt</span>
<span class="n">mobility_trends_countries_long</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span>
    <span class="n">mobility_trends_countries</span><span class="p">,</span>
    <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;country_region&quot;</span><span class="p">,</span> <span class="s2">&quot;sub_region_1&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">],</span>
    <span class="c1"># The columns &#39;date&#39; and &#39;sub_region_1&#39; are not needed for the box</span>
    <span class="c1"># plots below but we will need the two variables in subsequent tasks.</span>
    <span class="n">value_vars</span><span class="o">=</span><span class="n">mobility_trends_countries</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">15</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">mobility_trends_countries_long</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>country_region</th>
      <th>sub_region_1</th>
      <th>date</th>
      <th>variable</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>502</th>
      <td>Germany</td>
      <td>Baden-Württemberg</td>
      <td>2020-02-15</td>
      <td>Retail_Recreation</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>503</th>
      <td>Germany</td>
      <td>Baden-Württemberg</td>
      <td>2020-02-16</td>
      <td>Retail_Recreation</td>
      <td>23.0</td>
    </tr>
    <tr>
      <th>504</th>
      <td>Germany</td>
      <td>Baden-Württemberg</td>
      <td>2020-02-17</td>
      <td>Retail_Recreation</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>505</th>
      <td>Germany</td>
      <td>Baden-Württemberg</td>
      <td>2020-02-18</td>
      <td>Retail_Recreation</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>506</th>
      <td>Germany</td>
      <td>Baden-Württemberg</td>
      <td>2020-02-19</td>
      <td>Retail_Recreation</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2916551</th>
      <td>Sweden</td>
      <td>Västra Götaland County</td>
      <td>2021-06-24</td>
      <td>Residential</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2916552</th>
      <td>Sweden</td>
      <td>Västra Götaland County</td>
      <td>2021-06-25</td>
      <td>Residential</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>2916555</th>
      <td>Sweden</td>
      <td>Västra Götaland County</td>
      <td>2021-06-28</td>
      <td>Residential</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>2916556</th>
      <td>Sweden</td>
      <td>Västra Götaland County</td>
      <td>2021-06-29</td>
      <td>Residential</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>2916557</th>
      <td>Sweden</td>
      <td>Västra Götaland County</td>
      <td>2021-06-30</td>
      <td>Residential</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
<p>2446789 rows × 5 columns</p>
</div></div></div>
</div>
<p>The resulting DataFrame <code class="docutils literal notranslate"><span class="pre">mobility_trends_countries_long</span></code> contains two new columns: <code class="docutils literal notranslate"><span class="pre">variable</span></code> containing the six mobility categories per country per date, and <code class="docutils literal notranslate"><span class="pre">value</span></code> containing the values of those categories (percent change from baseline).</p>
</div>
<div class="section" id="multi-plot-visualisations">
<h1>Multi-plot visualisations<a class="headerlink" href="#multi-plot-visualisations" title="Permalink to this headline">¶</a></h1>
<p>To plot the six mobility categories simultaneously in a multi-plot, we simply add the parameter <code class="docutils literal notranslate"><span class="pre">col</span></code> and provide as an argument our categorical variable labeled <code class="docutils literal notranslate"><span class="pre">variable</span></code>. Our six mobility categories will be plotted in a grid of six columns. Setting the <code class="docutils literal notranslate"><span class="pre">col_wrap</span></code> parameter to 2 will plot the six variables in two columns, spanning three rows. We change the kind of plot we would like to draw to <a class="reference external" href="https://seaborn.pydata.org/generated/seaborn.boxenplot.html#seaborn.boxenplot"><code class="docutils literal notranslate"><span class="pre">boxen</span></code></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Differences in multiple mobility trends across selected countries</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;country_region&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
    <span class="n">col</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span>
    <span class="n">col_wrap</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;boxen&quot;</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">aspect</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>  <span class="c1"># control plot size</span>
    <span class="n">data</span><span class="o">=</span><span class="n">mobility_trends_countries_long</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/05_data_exploration_and_visualisation_29_0.png" src="../_images/05_data_exploration_and_visualisation_29_0.png" />
</div>
</div>
<p>The plots above have one deficiency — different mobility categories share the same <code class="docutils literal notranslate"><span class="pre">y</span></code> axis. Because the axis range is predominantly determined by one mobility category (parks mobility) and its wide distribution, the plots barely display the way in which the six countries differ with respect to the remaining five mobility category. We resolve this problem by simply setting the parameter <code class="docutils literal notranslate"><span class="pre">sharey</span></code> to False and redrawing the figure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;country_region&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
    <span class="n">col</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span>
    <span class="n">col_wrap</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;boxen&quot;</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">aspect</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>  <span class="c1"># control plot size</span>
    <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># set different y axes for each plot</span>
    <span class="n">data</span><span class="o">=</span><span class="n">mobility_trends_countries_long</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/05_data_exploration_and_visualisation_31_0.png" src="../_images/05_data_exploration_and_visualisation_31_0.png" />
</div>
</div>
</div>
<div class="section" id="hands-on-exercise">
<h1>Hands-on exercise<a class="headerlink" href="#hands-on-exercise" title="Permalink to this headline">¶</a></h1>
<p>Visualise mobility categories for a different set of countries of your choice. Update the labels and interpret your results. Employ a different kind of <code class="docutils literal notranslate"><span class="pre">catplot</span></code>, for example <code class="docutils literal notranslate"><span class="pre">violin</span></code>.</p>
</div>
<div class="section" id="rq2-how-do-mobility-trends-change-over-time">
<h1>RQ2: How do mobility trends change over time?<a class="headerlink" href="#rq2-how-do-mobility-trends-change-over-time" title="Permalink to this headline">¶</a></h1>
<p>Our graphics so far summarised the time series mobility data without visualising longitudinal trends. In this section, you will learn how to visualise time series data in order to characterise mobility trends across countries and along time.</p>
</div>
<div class="section" id="visualising-time-series-data">
<h1>Visualising time series data<a class="headerlink" href="#visualising-time-series-data" title="Permalink to this headline">¶</a></h1>
<p>We will use the function <code class="docutils literal notranslate"><span class="pre">relplot()</span></code> for drawing relational plots onto a multi-plot grid. Using the function, we will produce six plots for the six mobility categories. Each plot will represent the relationship between two variables, time and mean mobility percent change from baseline.</p>
<p>Let’s have a look at the parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code> — Numerical variables on the x and y axes. We plot <code class="docutils literal notranslate"><span class="pre">date</span></code> on the x axis and the <code class="docutils literal notranslate"><span class="pre">value</span></code> of percent mobility change from baseline on the y axis.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hue</span></code> — Grouping variable that will map elements to different colors. Our grouping variable is <code class="docutils literal notranslate"><span class="pre">country_region</span></code>, meaning that the line for each country will be colored differently.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kind</span></code> — Kind of plot to draw, with two options: <code class="docutils literal notranslate"><span class="pre">scatter</span></code> (default) and <code class="docutils literal notranslate"><span class="pre">line</span></code>. We use <code class="docutils literal notranslate"><span class="pre">line</span></code> in order to visualise the trend in data.</p></li>
</ul>
<p>The resulting plot shows the mean percent change and 99% confidence intervals for each mobility category. The 99% CI are computed using bootstrapping. Observations are sorted by time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot daily mobility trends across mobility categories and countries of interest</span>

<span class="n">grid</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">relplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
    <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;country_region&quot;</span><span class="p">,</span>
    <span class="n">col</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span>
    <span class="n">col_wrap</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">aspect</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">ci</span><span class="o">=</span><span class="mi">99</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
    <span class="n">facet_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;sharey&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;sharex&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">mobility_trends_countries_long</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">grid</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Mean mobility change from baseline (%)&quot;</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># For each plot, draw a horizontal line at y = 0 representing the baseline</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">grid</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/05_data_exploration_and_visualisation_34_0.png" src="../_images/05_data_exploration_and_visualisation_34_0.png" />
</div>
</div>
</div>
<div class="section" id="bootstrapping-for-inference">
<h1>Bootstrapping for inference<a class="headerlink" href="#bootstrapping-for-inference" title="Permalink to this headline">¶</a></h1>
<p>We calculated above a point estimate — mean per cent mobility change from baseline — for each mobility category per day and per country between March 2020 and May 2021. The point estimate likely contains some error and thus, it rarely captures the exact population parameter. Therefore, in addition to our point estimate, we need to compute a range of plausible values that, with some degree of certainty, contains the true population parameter. This range of plausible values is called a <em>confidence interval</em>. Confidence intervals are typically constructed using confidence levels of 95% or 99%.</p>
<p>We compute the 99% confidence intervals around the mean, representing the uncertainty of the mean estimate. The 99% confidence interval is a range of plausible values that you can be 99% certain contain the true mean of the population parameter.</p>
<p>To construct confidence intervals on the mean (and other sample statistics), <code class="docutils literal notranslate"><span class="pre">Seaborn</span></code> uses a procedure called bootstrapping. The bootstrapping is a resampling method of statistical inference that is alternative to the classical approach of hypothesis testing. (Other resampling methods include random permutation.) The bootstrap method uses the original sample of our data to generate another random sample that resembles the population, following these steps:</p>
<blockquote>
<div><ul class="simple">
<li><p>Treat the original sample as if it were the population.</p></li>
<li><p>Draw from the sample, at random with replacement, the same number of times as the original sample size.</p></li>
</ul>
<img src="https://inferentialthinking.com/_images/Bootstrap_26_0.png" title='Pandas DataFrame' width="600" height="300"/>
<p>Source: Ani Adhikari and John DeNero (with David Wagner and Henry Milner). <a class="reference external" href="https://inferentialthinking.com/chapters/intro.html">Computational and Inferential Thinking: The Foundations of Data Science.</a></p>
</div></blockquote>
<br>
<p>In our example, the data for each mobility category and day within a country is treated as a sample on which bootstrapping on the mean is performed. After each bootstrap resample, the mean is computed, generating a distribution from where the confidence intervals for the mean are constructed.</p>
<p>When you compute bootstrap confidence intervals in <code class="docutils literal notranslate"><span class="pre">Seaborn</span></code>, you can set the following parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ci</span></code> — Confidence level that will determine the size of the confidence interval. Commonly used confidence levels include 95% and 99%. The default confidence level in the current version of <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> is 95%.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n-boot</span></code> — Number of bootstrap resamples. By default, <code class="docutils literal notranslate"><span class="pre">Seaborn</span></code> uses 1000 bootstrap resamples for computing the confidence intervals. You could set a greater number of bootstrap resamples — for example 10,000, by typing <code class="docutils literal notranslate"><span class="pre">n_boot=10000</span></code> — but keep in mind that increasing the number of resamples can be time-consuming for large data sets.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">seed</span></code> — Seed reproducible bootstrapping. The easiest way is to specify an integer.</p></li>
</ul>
<p>There are many good introductions to resampling methods (including bootstrapping) and inference. See the section on <a class="reference external" href="https://inferentialthinking.com/chapters/13/2/Bootstrap.html">the Bootstrap</a> in Ani Adhikari and John DeNero (with David Wagner and Henry Milner). <a class="reference external" href="https://inferentialthinking.com/chapters/intro.html">Computational and Inferential Thinking: The Foundations of Data Science</a>. Another useful resource is David Diez, Christopher Barr, Mine Cetinkaya-Rundel. <a class="reference external" href="https://www.openintro.org/book/isrs/">Introductory Statistics with Randomization and Simulation</a>, OpenIntro. See also the informative and entertaining talk by John Rauser <a class="reference external" href="https://www.youtube.com/watch?v=5Dnw46eC-0o">Statistics Without the Agonizing Pain</a>, Strata + Hadoop 2014, on using resampling methods for making inference.</p>
</div>
<div class="section" id="rq3-how-have-mobility-trends-differed-across-uk-lockdowns">
<h1>RQ3: How have mobility trends differed across UK lockdowns?<a class="headerlink" href="#rq3-how-have-mobility-trends-differed-across-uk-lockdowns" title="Permalink to this headline">¶</a></h1>
<p>Our next research question aims to explore differences in mobility trends across the three national lockdowns in the United Kingdom. Because the three lockdowns brought different measures, restrictions, and regulations, differences in mobility trends should not be interpreted as a direct indication of compliance or non-compliance with lockdown rules.</p>
<p>We will use the first three weeks of each lockdown to compare the three lockdowns. Let’s select the data for the first lockdown (24 March 2020 — 13 April 2020), second lockdown (5 November 2020 — 25 November 2020), and third lockdown (6 January 2021 — 26 January 2021) in the United Kingdom.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create three new DataFrames, each containing a subset of data about</span>
<span class="c1"># the first three weeks of the respective lockdown</span>

<span class="n">first_lockdown_UK</span> <span class="o">=</span> <span class="n">mobility_trends_countries_long</span><span class="p">[</span>
    <span class="p">(</span><span class="n">mobility_trends_countries_long</span><span class="p">[</span><span class="s2">&quot;country_region&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;United Kingdom&quot;</span><span class="p">)</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">mobility_trends_countries_long</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s2">&quot;2020-03-24&quot;</span><span class="p">)</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">mobility_trends_countries_long</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="s2">&quot;2020-04-13&quot;</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">second_lockdown_UK</span> <span class="o">=</span> <span class="n">mobility_trends_countries_long</span><span class="p">[</span>
    <span class="p">(</span><span class="n">mobility_trends_countries_long</span><span class="p">[</span><span class="s2">&quot;country_region&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;United Kingdom&quot;</span><span class="p">)</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">mobility_trends_countries_long</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s2">&quot;2020-11-05&quot;</span><span class="p">)</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">mobility_trends_countries_long</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="s2">&quot;2020-11-25&quot;</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">third_lockdown_UK</span> <span class="o">=</span> <span class="n">mobility_trends_countries_long</span><span class="p">[</span>
    <span class="p">(</span><span class="n">mobility_trends_countries_long</span><span class="p">[</span><span class="s2">&quot;country_region&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;United Kingdom&quot;</span><span class="p">)</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">mobility_trends_countries_long</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s2">&quot;2021-01-06&quot;</span><span class="p">)</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">mobility_trends_countries_long</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="s2">&quot;2021-01-26&quot;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show data about the first national lockdown in the UK</span>
<span class="c1"># (The dataframes for the other two lockdowns have the same number of columns)</span>
<span class="n">first_lockdown_UK</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>country_region</th>
      <th>sub_region_1</th>
      <th>date</th>
      <th>variable</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>95896</th>
      <td>United Kingdom</td>
      <td>Aberdeen City</td>
      <td>2020-03-24</td>
      <td>Retail_Recreation</td>
      <td>-75.0</td>
    </tr>
    <tr>
      <th>95897</th>
      <td>United Kingdom</td>
      <td>Aberdeen City</td>
      <td>2020-03-25</td>
      <td>Retail_Recreation</td>
      <td>-78.0</td>
    </tr>
    <tr>
      <th>95898</th>
      <td>United Kingdom</td>
      <td>Aberdeen City</td>
      <td>2020-03-26</td>
      <td>Retail_Recreation</td>
      <td>-80.0</td>
    </tr>
    <tr>
      <th>95899</th>
      <td>United Kingdom</td>
      <td>Aberdeen City</td>
      <td>2020-03-27</td>
      <td>Retail_Recreation</td>
      <td>-80.0</td>
    </tr>
    <tr>
      <th>95900</th>
      <td>United Kingdom</td>
      <td>Aberdeen City</td>
      <td>2020-03-28</td>
      <td>Retail_Recreation</td>
      <td>-87.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2734968</th>
      <td>United Kingdom</td>
      <td>York</td>
      <td>2020-04-06</td>
      <td>Residential</td>
      <td>28.0</td>
    </tr>
    <tr>
      <th>2734969</th>
      <td>United Kingdom</td>
      <td>York</td>
      <td>2020-04-07</td>
      <td>Residential</td>
      <td>28.0</td>
    </tr>
    <tr>
      <th>2734970</th>
      <td>United Kingdom</td>
      <td>York</td>
      <td>2020-04-08</td>
      <td>Residential</td>
      <td>28.0</td>
    </tr>
    <tr>
      <th>2734971</th>
      <td>United Kingdom</td>
      <td>York</td>
      <td>2020-04-09</td>
      <td>Residential</td>
      <td>28.0</td>
    </tr>
    <tr>
      <th>2734972</th>
      <td>United Kingdom</td>
      <td>York</td>
      <td>2020-04-10</td>
      <td>Residential</td>
      <td>33.0</td>
    </tr>
  </tbody>
</table>
<p>48902 rows × 5 columns</p>
</div></div></div>
</div>
</div>
<div class="section" id="visualising-lockdowns-mobility-as-barplots">
<h1>Visualising lockdowns’ mobility as barplots<a class="headerlink" href="#visualising-lockdowns-mobility-as-barplots" title="Permalink to this headline">¶</a></h1>
<p>Plot mean mobility change for the six mobility categories during the first lockdown in the UK using the Seaborn function <code class="docutils literal notranslate"><span class="pre">catplot()</span></code>. Error bars represent 95% confidence intervals.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span>
    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;country_region&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">first_lockdown_UK</span>
<span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Mean mobility change from baseline (%)&quot;</span><span class="p">)</span>
<span class="c1"># grid.set(ylim=(-80, 40)); uncomment to set the y axis to a particular range of values</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.FacetGrid at 0x7fd08feaee50&gt;
</pre></div>
</div>
<img alt="../_images/05_data_exploration_and_visualisation_41_1.png" src="../_images/05_data_exploration_and_visualisation_41_1.png" />
</div>
</div>
<p>Ideally, we would like to plot the three lockdowns as a multi-plot. To achieve this, we first concatenate the three DataFrames into one DataFrame using the Pandas <code class="docutils literal notranslate"><span class="pre">concat()</span></code> function. In addition, to add an identifier for each of three DataFrames in the new DataFrame, we specify their labels as a list for the parameter <code class="docutils literal notranslate"><span class="pre">keys</span></code>. We use the Pandas method <code class="docutils literal notranslate"><span class="pre">reset_index()</span></code> to add the three identifiers of the original lockdown DataFrames as a column ‘level_0’ in the new DataFrame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lockdowns_dataframes</span> <span class="o">=</span> <span class="p">[</span><span class="n">first_lockdown_UK</span><span class="p">,</span> <span class="n">second_lockdown_UK</span><span class="p">,</span> <span class="n">third_lockdown_UK</span><span class="p">]</span>
<span class="n">three_lockdowns_UK</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
    <span class="n">lockdowns_dataframes</span><span class="p">,</span>
    <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;first_lockdown_UK&quot;</span><span class="p">,</span> <span class="s2">&quot;second_lockdown_UK&quot;</span><span class="p">,</span> <span class="s2">&quot;third_lockdown_UK&quot;</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">three_lockdowns_UK</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>level_0</th>
      <th>level_1</th>
      <th>country_region</th>
      <th>sub_region_1</th>
      <th>date</th>
      <th>variable</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>first_lockdown_UK</td>
      <td>95896</td>
      <td>United Kingdom</td>
      <td>Aberdeen City</td>
      <td>2020-03-24</td>
      <td>Retail_Recreation</td>
      <td>-75.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>first_lockdown_UK</td>
      <td>95897</td>
      <td>United Kingdom</td>
      <td>Aberdeen City</td>
      <td>2020-03-25</td>
      <td>Retail_Recreation</td>
      <td>-78.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>first_lockdown_UK</td>
      <td>95898</td>
      <td>United Kingdom</td>
      <td>Aberdeen City</td>
      <td>2020-03-26</td>
      <td>Retail_Recreation</td>
      <td>-80.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>first_lockdown_UK</td>
      <td>95899</td>
      <td>United Kingdom</td>
      <td>Aberdeen City</td>
      <td>2020-03-27</td>
      <td>Retail_Recreation</td>
      <td>-80.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>first_lockdown_UK</td>
      <td>95900</td>
      <td>United Kingdom</td>
      <td>Aberdeen City</td>
      <td>2020-03-28</td>
      <td>Retail_Recreation</td>
      <td>-87.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>150176</th>
      <td>third_lockdown_UK</td>
      <td>2735259</td>
      <td>United Kingdom</td>
      <td>York</td>
      <td>2021-01-22</td>
      <td>Residential</td>
      <td>23.0</td>
    </tr>
    <tr>
      <th>150177</th>
      <td>third_lockdown_UK</td>
      <td>2735260</td>
      <td>United Kingdom</td>
      <td>York</td>
      <td>2021-01-23</td>
      <td>Residential</td>
      <td>16.0</td>
    </tr>
    <tr>
      <th>150178</th>
      <td>third_lockdown_UK</td>
      <td>2735261</td>
      <td>United Kingdom</td>
      <td>York</td>
      <td>2021-01-24</td>
      <td>Residential</td>
      <td>14.0</td>
    </tr>
    <tr>
      <th>150179</th>
      <td>third_lockdown_UK</td>
      <td>2735262</td>
      <td>United Kingdom</td>
      <td>York</td>
      <td>2021-01-25</td>
      <td>Residential</td>
      <td>21.0</td>
    </tr>
    <tr>
      <th>150180</th>
      <td>third_lockdown_UK</td>
      <td>2735263</td>
      <td>United Kingdom</td>
      <td>York</td>
      <td>2021-01-26</td>
      <td>Residential</td>
      <td>22.0</td>
    </tr>
  </tbody>
</table>
<p>150181 rows × 7 columns</p>
</div></div></div>
</div>
<p>We now visualise as a multi-plot grid the mean mobility trends and 95% CI for the three lockdowns in the United Kingdom. We specify the new categorical variable <code class="docutils literal notranslate"><span class="pre">level_0</span></code> to determine the faceting of the multi-plot grid.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display the three lockdowns as a catplot multi-plot</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span>
    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;country_region&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
    <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span>
    <span class="n">col</span><span class="o">=</span><span class="s2">&quot;level_0&quot;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">three_lockdowns_UK</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">set_ylabels</span><span class="p">(</span><span class="s2">&quot;Mean mobility change from baseline (%)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.FacetGrid at 0x7fcf8a34d820&gt;
</pre></div>
</div>
<img alt="../_images/05_data_exploration_and_visualisation_45_1.png" src="../_images/05_data_exploration_and_visualisation_45_1.png" />
</div>
</div>
<p>As a general tendency, the plots indicate that, on average, changes of mobility (compared to the baseline period in early 2020) during the first lockdown were greater that changes of mobility during the third lockdown, and both were greater than changes of mobility during the second lockdown.</p>
<div class="section" id="discussion-activity">
<h2>Discussion activity<a class="headerlink" href="#discussion-activity" title="Permalink to this headline">¶</a></h2>
<p>Different rules and restrictions were in place during the three lockdowns. Let’s discuss how those differences in restrictions were associated with differences in mobility during the three lockdowns across mobility categories.</p>
</div>
</div>
<div class="section" id="rq4-how-have-mobility-trends-differed-across-uk-counties-during-the-third-lockdown">
<h1>RQ4: How have mobility trends differed across UK counties during the third lockdown?<a class="headerlink" href="#rq4-how-have-mobility-trends-differed-across-uk-counties-during-the-third-lockdown" title="Permalink to this headline">¶</a></h1>
<p>We will now explore mobility trends across mobility categories and counties in the United Kingdom during the third lockdown. We employ the Seaborn <code class="docutils literal notranslate"><span class="pre">catplot()</span></code> function using one of our DataFrame ‘third_lockdown_UK’. We use the variable called <code class="docutils literal notranslate"><span class="pre">variable</span></code>, which contains the labels of the six mobility categories to determine the faceting of the multi-plot grid. The UK counties are on the vertical axis and the mean values of mobility change from baseline (%) are on the horizontal axis. The <code class="docutils literal notranslate"><span class="pre">violin</span></code> plot function computes, for each pair of country and mobility category, the mean mobility change and the distributions of the mobility percent change.</p>
</div>
<div class="section" id="id1">
<h1>Multi-plot visualisations<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>Note the simplicity of the code that produces the multi-plot and the richness of information it provides.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;sub_region_1&quot;</span><span class="p">,</span>
    <span class="n">col</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;violin&quot;</span><span class="p">,</span>
    <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span>
    <span class="n">aspect</span><span class="o">=</span><span class="mf">0.13</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">third_lockdown_UK</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/05_data_exploration_and_visualisation_48_0.png" src="../_images/05_data_exploration_and_visualisation_48_0.png" />
</div>
</div>
<p>The above plots are slightly difficult to interpret because the values of mean mobility are not sorted. An elegant approach to sorting would be to employ Pandas functionality and then pass the sorted mean mobility values to a Seaborn plot.</p>
</div>
<div class="section" id="split-apply-combine">
<h1>Split-apply-combine<a class="headerlink" href="#split-apply-combine" title="Permalink to this headline">¶</a></h1>
<p>To calculate the mean mobility change per both UK county and mobility category, we first need to split the data into groups where each <em>mobility category</em> per <em>county</em> is a group. Then, second, we will apply a function to calculate the mean for each of the split groups (mobility category per county) such that the daily values over the lockdown period for each mobility category per county will be summarised into a single mean value. Third, we will combine the individual calculations for each split group into a single DataFrame. The procedure is known as <em>split-apply-combine</em>. We will use the Pandas method <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html"><code class="docutils literal notranslate"><span class="pre">groupby()</span></code></a> to perform the procedure on the mobility trends data.</p>
</div>
<div class="section" id="summarising-data-by-groups">
<h1>Summarising data by groups<a class="headerlink" href="#summarising-data-by-groups" title="Permalink to this headline">¶</a></h1>
<p>We first specify the variables to be used to determine the groups. In our example, these are ‘variable’ and ‘sub_region_1’, resulting in 876 groups (6 mobility categories times 146 UK counties). Because we want to split the data into groups by two variables, we pass the variables within the <code class="docutils literal notranslate"><span class="pre">groupby()</span></code> methods as a list ‘[‘variable’, ‘sub_region_1’]’. We then specify the variable on which we want to perform the calculation (in our case, take the mean) and compute the mean for each of the 876 groups using the <code class="docutils literal notranslate"><span class="pre">mean()</span></code> method. We use the Pandas method <code class="docutils literal notranslate"><span class="pre">reset_index()</span></code> at the end of the command in order to convert the output (from Series) to a DataFrame. The output DataFrame ‘third_lockdown_UK_mean’ contains three columns: mobility categories (‘variable’), counties (‘sub_region_1’), and the mean (‘value’). Each row is a pair of mobility category and county, and their respective mean mobility change calculated over the three weeks’ period.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute grouped means using the Pandas gropupby() method</span>
<span class="n">third_lockdown_UK_mean</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">third_lockdown_UK</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="s2">&quot;sub_region_1&quot;</span><span class="p">])[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">third_lockdown_UK_mean</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>variable</th>
      <th>sub_region_1</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Grocery_Pharmacy</td>
      <td>Aberdeen City</td>
      <td>-25.333333</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Grocery_Pharmacy</td>
      <td>Aberdeenshire</td>
      <td>-26.190476</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Grocery_Pharmacy</td>
      <td>Angus Council</td>
      <td>-19.714286</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Grocery_Pharmacy</td>
      <td>Antrim and Newtownabbey</td>
      <td>-18.523810</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Grocery_Pharmacy</td>
      <td>Ards and North Down</td>
      <td>-13.285714</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>871</th>
      <td>Workplaces</td>
      <td>Windsor and Maidenhead</td>
      <td>-54.952381</td>
    </tr>
    <tr>
      <th>872</th>
      <td>Workplaces</td>
      <td>Wokingham</td>
      <td>-55.714286</td>
    </tr>
    <tr>
      <th>873</th>
      <td>Workplaces</td>
      <td>Worcestershire</td>
      <td>-42.469388</td>
    </tr>
    <tr>
      <th>874</th>
      <td>Workplaces</td>
      <td>Wrexham Principal Area</td>
      <td>-38.428571</td>
    </tr>
    <tr>
      <th>875</th>
      <td>Workplaces</td>
      <td>York</td>
      <td>-53.904762</td>
    </tr>
  </tbody>
</table>
<p>876 rows × 3 columns</p>
</div></div></div>
</div>
<p>Our next step is to sort in decreasing order the UK counties within each mobility category by their values of mean mobility change. We use the Pandas method <code class="docutils literal notranslate"><span class="pre">sort_values()</span></code> to accomplish that:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">third_lockdown_UK_mean_sorted</span> <span class="o">=</span> <span class="n">third_lockdown_UK_mean</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
    <span class="n">by</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;variable&quot;</span><span class="p">,</span>
        <span class="s2">&quot;value&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)[[</span><span class="s2">&quot;sub_region_1&quot;</span><span class="p">,</span> <span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">]]</span>
<span class="n">third_lockdown_UK_mean_sorted</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sub_region_1</th>
      <th>variable</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>737</th>
      <td>Blaenau Gwent</td>
      <td>Workplaces</td>
      <td>-29.523810</td>
    </tr>
    <tr>
      <th>803</th>
      <td>Mid Ulster</td>
      <td>Workplaces</td>
      <td>-31.142857</td>
    </tr>
    <tr>
      <th>816</th>
      <td>North East Lincolnshire</td>
      <td>Workplaces</td>
      <td>-32.523810</td>
    </tr>
    <tr>
      <th>825</th>
      <td>Orkney</td>
      <td>Workplaces</td>
      <td>-32.866667</td>
    </tr>
    <tr>
      <th>818</th>
      <td>North Lincolnshire</td>
      <td>Workplaces</td>
      <td>-33.380952</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Ceredigion</td>
      <td>Grocery_Pharmacy</td>
      <td>-31.142857</td>
    </tr>
    <tr>
      <th>83</th>
      <td>Monmouthshire</td>
      <td>Grocery_Pharmacy</td>
      <td>-32.095238</td>
    </tr>
    <tr>
      <th>77</th>
      <td>Merthyr Tydfil County Borough</td>
      <td>Grocery_Pharmacy</td>
      <td>-32.761905</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Bath and North East Somerset</td>
      <td>Grocery_Pharmacy</td>
      <td>-34.095238</td>
    </tr>
    <tr>
      <th>112</th>
      <td>Slough</td>
      <td>Grocery_Pharmacy</td>
      <td>-35.523810</td>
    </tr>
  </tbody>
</table>
<p>876 rows × 3 columns</p>
</div></div></div>
</div>
<p>We now plot the mean mobility change across UK counties sorted by Workplaces mobility in decreasing order. We can easily see, for example, that workplaces mobility was the most reduced in Edinburgh and Greater London. However, counties were sorted only in the Workplaces mobility category while in the remaining categories counties follow the ranking as specified in Workplaces mobility.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;sub_region_1&quot;</span><span class="p">,</span>
    <span class="n">col</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;strip&quot;</span><span class="p">,</span>
    <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span>
    <span class="n">aspect</span><span class="o">=</span><span class="mf">0.13</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">third_lockdown_UK_mean_sorted</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/05_data_exploration_and_visualisation_54_0.png" src="../_images/05_data_exploration_and_visualisation_54_0.png" />
</div>
</div>
<p>Typically, we are interested in computing multiple descriptive statistics in addition to the mean (e.g., median). We can compute multiple descriptive statistics using the Pandas method <code class="docutils literal notranslate"><span class="pre">agg()</span></code>. The code below is similar to the one we used to compute the mean on groups but this time we do not compute only the mean but many descriptive statistics at once. Specifically, we create a list of all the descriptive statistics we are interested in computing <code class="docutils literal notranslate"><span class="pre">[min,</span> <span class="pre">max,</span> <span class="pre">np.mean,</span> <span class="pre">np.median,</span> <span class="pre">np.std]</span></code> which is then passed inside the brackets of the <code class="docutils literal notranslate"><span class="pre">agg()</span></code> method. Note that some descriptive statistics are computed using built-in functions from the <a class="reference external" href="https://docs.python.org/3/library/">Python Standard Library</a> (e.g., <code class="docutils literal notranslate"><span class="pre">min</span></code> and <code class="docutils literal notranslate"><span class="pre">max</span></code>) while others are computed using <a class="reference external" href="https://numpy.org">NumPy</a> functions (e.g., <code class="docutils literal notranslate"><span class="pre">np.mean</span></code>, <code class="docutils literal notranslate"><span class="pre">np.median</span></code>, and <code class="docutils literal notranslate"><span class="pre">np.std</span></code>). The resulting DataFrame contains a column for each descriptive statistic in addition to the grouping columns ‘sub_region_1’ and ‘variable’.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">third_lockdown_UK_descriptive_stats</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">third_lockdown_UK</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;sub_region_1&quot;</span><span class="p">,</span> <span class="s2">&quot;variable&quot;</span><span class="p">])[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">])</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">third_lockdown_UK_descriptive_stats</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sub_region_1</th>
      <th>variable</th>
      <th>min</th>
      <th>max</th>
      <th>mean</th>
      <th>median</th>
      <th>std</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aberdeen City</td>
      <td>Grocery_Pharmacy</td>
      <td>-33.0</td>
      <td>-20.0</td>
      <td>-25.333333</td>
      <td>-24.0</td>
      <td>2.921187</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Aberdeen City</td>
      <td>Parks</td>
      <td>-51.0</td>
      <td>42.0</td>
      <td>-3.142857</td>
      <td>-4.0</td>
      <td>20.060622</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Aberdeen City</td>
      <td>Residential</td>
      <td>11.0</td>
      <td>24.0</td>
      <td>19.809524</td>
      <td>22.0</td>
      <td>4.319943</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Aberdeen City</td>
      <td>Retail_Recreation</td>
      <td>-79.0</td>
      <td>-68.0</td>
      <td>-72.047619</td>
      <td>-71.0</td>
      <td>3.138092</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Aberdeen City</td>
      <td>Transit_stations</td>
      <td>-64.0</td>
      <td>-55.0</td>
      <td>-58.619048</td>
      <td>-58.0</td>
      <td>2.290768</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>871</th>
      <td>York</td>
      <td>Parks</td>
      <td>-63.0</td>
      <td>-22.0</td>
      <td>-46.190476</td>
      <td>-45.0</td>
      <td>10.975514</td>
    </tr>
    <tr>
      <th>872</th>
      <td>York</td>
      <td>Residential</td>
      <td>13.0</td>
      <td>25.0</td>
      <td>20.666667</td>
      <td>22.0</td>
      <td>3.799123</td>
    </tr>
    <tr>
      <th>873</th>
      <td>York</td>
      <td>Retail_Recreation</td>
      <td>-78.0</td>
      <td>-64.0</td>
      <td>-70.571429</td>
      <td>-69.0</td>
      <td>4.307800</td>
    </tr>
    <tr>
      <th>874</th>
      <td>York</td>
      <td>Transit_stations</td>
      <td>-78.0</td>
      <td>-69.0</td>
      <td>-73.380952</td>
      <td>-74.0</td>
      <td>2.578298</td>
    </tr>
    <tr>
      <th>875</th>
      <td>York</td>
      <td>Workplaces</td>
      <td>-60.0</td>
      <td>-41.0</td>
      <td>-53.904762</td>
      <td>-57.0</td>
      <td>6.847662</td>
    </tr>
  </tbody>
</table>
<p>876 rows × 7 columns</p>
</div></div></div>
</div>
<p>Let’s put in use the descriptive statistics indices we created. For example, we can determine the UK county with the most reduced median Retail and Recreation mobility during the third lockdown. We first access all the rows about Retail and Recreation mobility. We then use the Pandas <code class="docutils literal notranslate"><span class="pre">sort_values</span></code> function to sort all counties by their median mobility change in decreasing order. The output shows that Bath and North East Somerset is the county with the most reduced Retail and Recreation mobility during the third lockdown.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">third_lockdown_UK_descriptive_stats</span><span class="p">[</span>
    <span class="n">third_lockdown_UK_descriptive_stats</span><span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Retail_Recreation&quot;</span>
<span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sub_region_1</th>
      <th>variable</th>
      <th>min</th>
      <th>max</th>
      <th>mean</th>
      <th>median</th>
      <th>std</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>44</th>
      <td>Bath and North East Somerset</td>
      <td>Retail_Recreation</td>
      <td>-82.0</td>
      <td>-71.0</td>
      <td>-76.000000</td>
      <td>-76.0</td>
      <td>2.898275</td>
    </tr>
    <tr>
      <th>575</th>
      <td>Nottingham</td>
      <td>Retail_Recreation</td>
      <td>-80.0</td>
      <td>-68.0</td>
      <td>-73.619048</td>
      <td>-74.0</td>
      <td>3.513918</td>
    </tr>
    <tr>
      <th>284</th>
      <td>Edinburgh</td>
      <td>Retail_Recreation</td>
      <td>-78.0</td>
      <td>-69.0</td>
      <td>-73.809524</td>
      <td>-74.0</td>
      <td>2.400397</td>
    </tr>
    <tr>
      <th>126</th>
      <td>Cardiff</td>
      <td>Retail_Recreation</td>
      <td>-77.0</td>
      <td>-67.0</td>
      <td>-72.523810</td>
      <td>-73.0</td>
      <td>2.441701</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Aberdeen City</td>
      <td>Retail_Recreation</td>
      <td>-79.0</td>
      <td>-68.0</td>
      <td>-72.047619</td>
      <td>-71.0</td>
      <td>3.138092</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>114</th>
      <td>Caerphilly County Borough</td>
      <td>Retail_Recreation</td>
      <td>-64.0</td>
      <td>-46.0</td>
      <td>-50.238095</td>
      <td>-50.0</td>
      <td>3.871754</td>
    </tr>
    <tr>
      <th>167</th>
      <td>Clackmannanshire</td>
      <td>Retail_Recreation</td>
      <td>-57.0</td>
      <td>-42.0</td>
      <td>-49.352941</td>
      <td>-49.0</td>
      <td>4.076475</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Angus Council</td>
      <td>Retail_Recreation</td>
      <td>-58.0</td>
      <td>-41.0</td>
      <td>-49.904762</td>
      <td>-49.0</td>
      <td>4.380694</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Ards and North Down</td>
      <td>Retail_Recreation</td>
      <td>-56.0</td>
      <td>-41.0</td>
      <td>-47.857143</td>
      <td>-47.0</td>
      <td>3.650832</td>
    </tr>
    <tr>
      <th>266</th>
      <td>East Renfrewshire Council</td>
      <td>Retail_Recreation</td>
      <td>-55.0</td>
      <td>-35.0</td>
      <td>-46.190476</td>
      <td>-47.0</td>
      <td>4.331501</td>
    </tr>
  </tbody>
</table>
<p>148 rows × 7 columns</p>
</div></div></div>
</div>
<p>We can use the above commands to find any value of interest. For example, we can find the county with the greatest increase of Parks mobility from baseline by using the <code class="docutils literal notranslate"><span class="pre">max</span></code> value and accessing data about the Parks mobility category.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">third_lockdown_UK_descriptive_stats</span><span class="p">[</span>
    <span class="n">third_lockdown_UK_descriptive_stats</span><span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Parks&quot;</span>
<span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sub_region_1</th>
      <th>variable</th>
      <th>min</th>
      <th>max</th>
      <th>mean</th>
      <th>median</th>
      <th>std</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>288</th>
      <td>Essex</td>
      <td>Parks</td>
      <td>-69.0</td>
      <td>270.0</td>
      <td>-3.511737</td>
      <td>-12.0</td>
      <td>45.749895</td>
    </tr>
    <tr>
      <th>213</th>
      <td>Derbyshire</td>
      <td>Parks</td>
      <td>-86.0</td>
      <td>168.0</td>
      <td>0.476744</td>
      <td>-4.5</td>
      <td>45.763114</td>
    </tr>
    <tr>
      <th>330</th>
      <td>Greater London</td>
      <td>Parks</td>
      <td>-94.0</td>
      <td>131.0</td>
      <td>-3.167376</td>
      <td>-3.0</td>
      <td>35.234568</td>
    </tr>
    <tr>
      <th>412</th>
      <td>Leicester</td>
      <td>Parks</td>
      <td>-24.0</td>
      <td>110.0</td>
      <td>5.666667</td>
      <td>1.0</td>
      <td>28.812035</td>
    </tr>
    <tr>
      <th>628</th>
      <td>Reading</td>
      <td>Parks</td>
      <td>-29.0</td>
      <td>101.0</td>
      <td>6.526316</td>
      <td>1.0</td>
      <td>28.083939</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>847</th>
      <td>Windsor and Maidenhead</td>
      <td>Parks</td>
      <td>-63.0</td>
      <td>-27.0</td>
      <td>-43.666667</td>
      <td>-42.0</td>
      <td>9.640194</td>
    </tr>
    <tr>
      <th>436</th>
      <td>Luton</td>
      <td>Parks</td>
      <td>-30.0</td>
      <td>-29.0</td>
      <td>-29.333333</td>
      <td>-29.0</td>
      <td>0.577350</td>
    </tr>
    <tr>
      <th>148</th>
      <td>Ceredigion</td>
      <td>Parks</td>
      <td>-56.0</td>
      <td>-33.0</td>
      <td>-43.857143</td>
      <td>-43.0</td>
      <td>6.966245</td>
    </tr>
    <tr>
      <th>342</th>
      <td>Gwynedd</td>
      <td>Parks</td>
      <td>-71.0</td>
      <td>-45.0</td>
      <td>-59.714286</td>
      <td>-61.0</td>
      <td>6.827466</td>
    </tr>
    <tr>
      <th>651</th>
      <td>Rutland</td>
      <td>Parks</td>
      <td>-55.0</td>
      <td>-55.0</td>
      <td>-55.000000</td>
      <td>-55.0</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
<p>135 rows × 7 columns</p>
</div></div></div>
</div>
</div>
<div class="section" id="rq5-how-do-mobility-categories-relate-to-each-other">
<h1>RQ5: How do mobility categories relate to each other?<a class="headerlink" href="#rq5-how-do-mobility-categories-relate-to-each-other" title="Permalink to this headline">¶</a></h1>
<p>We will now visualise distributions of the six mobility categories and examine similarities and differences as well as relationships between the distributions of mobility categories. We can use a histogram to visualise the distribution of mobility categories. The code below employs the Seaborn <code class="docutils literal notranslate"><span class="pre">histplot()</span></code> function to plot the distribution of Workplaces mobility in the UK since mid-February 2020 as a histogram.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We first select data for the UK only</span>
<span class="n">mobility_trends_UK</span> <span class="o">=</span> <span class="n">mobility_trends</span><span class="p">[</span>
    <span class="n">mobility_trends</span><span class="p">[</span><span class="s2">&quot;country_region&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;United Kingdom&quot;</span>
<span class="p">]</span>
<span class="n">mobility_trends_UK</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>country_region_code</th>
      <th>country_region</th>
      <th>sub_region_1</th>
      <th>sub_region_2</th>
      <th>metro_area</th>
      <th>iso_3166_2_code</th>
      <th>census_fips_code</th>
      <th>place_id</th>
      <th>date</th>
      <th>Retail_Recreation</th>
      <th>Grocery_Pharmacy</th>
      <th>Parks</th>
      <th>Transit_stations</th>
      <th>Workplaces</th>
      <th>Residential</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3577753</th>
      <td>GB</td>
      <td>United Kingdom</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ChIJqZHHQhE7WgIReiWIMkOg-MQ</td>
      <td>2020-02-15</td>
      <td>-12.0</td>
      <td>-7.0</td>
      <td>-35.0</td>
      <td>-12.0</td>
      <td>-4.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>3577754</th>
      <td>GB</td>
      <td>United Kingdom</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ChIJqZHHQhE7WgIReiWIMkOg-MQ</td>
      <td>2020-02-16</td>
      <td>-7.0</td>
      <td>-6.0</td>
      <td>-28.0</td>
      <td>-7.0</td>
      <td>-3.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3577755</th>
      <td>GB</td>
      <td>United Kingdom</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ChIJqZHHQhE7WgIReiWIMkOg-MQ</td>
      <td>2020-02-17</td>
      <td>10.0</td>
      <td>1.0</td>
      <td>24.0</td>
      <td>-2.0</td>
      <td>-14.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>3577756</th>
      <td>GB</td>
      <td>United Kingdom</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ChIJqZHHQhE7WgIReiWIMkOg-MQ</td>
      <td>2020-02-18</td>
      <td>7.0</td>
      <td>-1.0</td>
      <td>20.0</td>
      <td>-3.0</td>
      <td>-14.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>3577757</th>
      <td>GB</td>
      <td>United Kingdom</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ChIJqZHHQhE7WgIReiWIMkOg-MQ</td>
      <td>2020-02-19</td>
      <td>6.0</td>
      <td>-2.0</td>
      <td>8.0</td>
      <td>-4.0</td>
      <td>-14.0</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="visualising-distributions">
<h1>Visualising distributions<a class="headerlink" href="#visualising-distributions" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the distribution of the Workplaces mobility category as a histogram</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">mobility_trends_UK</span><span class="p">[</span><span class="s2">&quot;Workplaces&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Change the label of the horizontal axis</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Mean workplaces mobility in the UK&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/05_data_exploration_and_visualisation_64_0.png" src="../_images/05_data_exploration_and_visualisation_64_0.png" />
</div>
</div>
<p>The distribution of Workplaces mobility appears symmetric, meaning that the left side of the distribution largely mirrors the right side.</p>
<p>In addition, we can use the <code class="docutils literal notranslate"><span class="pre">histplot()</span></code> to compare any two or more distributions by plotting them simultaneously.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot two (or more) variables as histograms in a single plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span>
    <span class="n">mobility_trends_UK</span><span class="p">[[</span><span class="s2">&quot;Workplaces&quot;</span><span class="p">,</span> <span class="s2">&quot;Retail_Recreation&quot;</span><span class="p">]],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:ylabel=&#39;Count&#39;&gt;
</pre></div>
</div>
<img alt="../_images/05_data_exploration_and_visualisation_66_1.png" src="../_images/05_data_exploration_and_visualisation_66_1.png" />
</div>
</div>
<p>Both distributions appear symmetric. The distribution of Retail and Recreation mobility is slightly wider compared to the distribution of Workplaces mobility which is more centered around the mean. We can examine the distributions further by computing the mean and the standard deviation of mobility change in the UK across the six mobility categories since mid-February 2020.</p>
<p>Mean mobility change in the UK across mobility categories.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends_UK</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">9</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Retail_Recreation   -36.809680
Grocery_Pharmacy     -8.658667
Parks                28.105415
Transit_stations    -38.142992
Workplaces          -35.856338
Residential          12.764187
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Standard deviation (std) of mobility change in the UK across mobility categories.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends_UK</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">9</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Retail_Recreation    26.273590
Grocery_Pharmacy     16.426443
Parks                54.650707
Transit_stations     23.548502
Workplaces           19.692586
Residential           7.421347
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>These outputs confirm that the distribution of Retail and Recreation mobility is slightly wider (std = 25.1) compared to the distribution of Workplaces mobility (std = 19.7).</p>
</div>
<div class="section" id="plotting-pairwise-relationships">
<h1>Plotting pairwise relationships<a class="headerlink" href="#plotting-pairwise-relationships" title="Permalink to this headline">¶</a></h1>
<p>You can obtain a summary of interesting pairwise relationships between mobility categories in your data set. In Seaborn, <code class="docutils literal notranslate"><span class="pre">PairGrid</span></code> allows you to draw a grid of small subplots where each row and column corresponds to a different variable. The resulting grid displays all the pairwise relationships in the data set. In the case of mobility data, the plot displays all pairwise relationships between the mean mobility change for each mobility category in the United Kingdom since mid February 2020. Each data point in the plots below represents a UK county. The plot enables a quick examination of pairwise relationships between those mean mobility changes across counties, and makes easy to determine in an ‘open-minded’ manner apparent positive relationships, negative relationships, or no relationships.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute the mean mobility change for each mobility category across UK counties</span>
<span class="n">mobility_trends_UK_mean</span> <span class="o">=</span> <span class="n">mobility_trends_UK</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;sub_region_1&quot;</span><span class="p">)[</span>
    <span class="p">[</span>
        <span class="s2">&quot;Retail_Recreation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Grocery_Pharmacy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Parks&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Transit_stations&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Workplaces&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Residential&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># Check the data in the DataFrame of mean mobility change we computed</span>
<span class="n">mobility_trends_UK_mean</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Retail_Recreation</th>
      <th>Grocery_Pharmacy</th>
      <th>Parks</th>
      <th>Transit_stations</th>
      <th>Workplaces</th>
      <th>Residential</th>
    </tr>
    <tr>
      <th>sub_region_1</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Aberdeen City</th>
      <td>-50.046371</td>
      <td>-10.722567</td>
      <td>20.557692</td>
      <td>-46.127016</td>
      <td>-42.489919</td>
      <td>14.567010</td>
    </tr>
    <tr>
      <th>Aberdeenshire</th>
      <td>-28.253669</td>
      <td>-11.248447</td>
      <td>22.474684</td>
      <td>-39.953878</td>
      <td>-37.207661</td>
      <td>12.222222</td>
    </tr>
    <tr>
      <th>Angus Council</th>
      <td>-25.955975</td>
      <td>-6.125786</td>
      <td>13.982143</td>
      <td>-31.150943</td>
      <td>-33.542339</td>
      <td>10.831551</td>
    </tr>
    <tr>
      <th>Antrim and Newtownabbey</th>
      <td>-29.377358</td>
      <td>-7.465409</td>
      <td>-29.134328</td>
      <td>-53.752621</td>
      <td>-33.679435</td>
      <td>12.859031</td>
    </tr>
    <tr>
      <th>Ards and North Down</th>
      <td>-27.262055</td>
      <td>0.452830</td>
      <td>6.838298</td>
      <td>-41.721311</td>
      <td>-35.991935</td>
      <td>12.679039</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Draw a multi-grid scatterplots of pairwise relationships</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">PairGrid</span><span class="p">(</span><span class="n">mobility_trends_UK_mean</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.PairGrid at 0x7fd04f09d6a0&gt;
</pre></div>
</div>
<img alt="../_images/05_data_exploration_and_visualisation_74_1.png" src="../_images/05_data_exploration_and_visualisation_74_1.png" />
</div>
</div>
<p>The information on the diagonal is not informative as it shows how a variable is correlated with itself. Instead, we could display a histogram on the diagonal representing the distribution of each mobility category.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Draw a multi-plot of scatterplots representing pairwise relationships</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">PairGrid</span><span class="p">(</span><span class="n">mobility_trends_UK_mean</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">map_diag</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">map_offdiag</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.PairGrid at 0x7fcf928a1940&gt;
</pre></div>
</div>
<img alt="../_images/05_data_exploration_and_visualisation_76_1.png" src="../_images/05_data_exploration_and_visualisation_76_1.png" />
</div>
</div>
<div class="section" id="interpreting-pairwise-relationships">
<h2>Interpreting pairwise relationships<a class="headerlink" href="#interpreting-pairwise-relationships" title="Permalink to this headline">¶</a></h2>
<p>Let’s interpret the pairwise relationships between the mean mobility trends. Which mobility trends appear to be involved in:</p>
<ul class="simple">
<li><p>positive relationship</p></li>
<li><p>negative relationship</p></li>
<li><p>no relationship</p></li>
</ul>
<p>Recall that each data point represents a UK county.</p>
</div>
</div>
<div class="section" id="rq6-how-correlated-are-mobility-categories-across-uk-counties">
<h1>RQ6: How correlated are mobility categories across UK counties?<a class="headerlink" href="#rq6-how-correlated-are-mobility-categories-across-uk-counties" title="Permalink to this headline">¶</a></h1>
<p>We first perform correlation analysis to determine the strength and the direction of the relationship between our six mobility categories. We use the Pandas function <code class="docutils literal notranslate"><span class="pre">corr()</span></code> to compute the correlation coefficients and then pass the output to the Seaborn <code class="docutils literal notranslate"><span class="pre">heatmap()</span></code> function to visualise the strength and direction of the relationships.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute pairwise correlation between our six mobility categories</span>
<span class="c1"># using the original (non-aggregated) mobility_trends_UK DataFrame.</span>
<span class="n">mobility_trends_UK_corr</span> <span class="o">=</span> <span class="n">mobility_trends_UK</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">9</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">mobility_trends_UK_corr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Retail_Recreation</th>
      <th>Grocery_Pharmacy</th>
      <th>Parks</th>
      <th>Transit_stations</th>
      <th>Workplaces</th>
      <th>Residential</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Retail_Recreation</th>
      <td>1.000000</td>
      <td>0.741545</td>
      <td>0.434700</td>
      <td>0.727399</td>
      <td>0.583437</td>
      <td>-0.714937</td>
    </tr>
    <tr>
      <th>Grocery_Pharmacy</th>
      <td>0.741545</td>
      <td>1.000000</td>
      <td>0.429703</td>
      <td>0.582958</td>
      <td>0.501260</td>
      <td>-0.539698</td>
    </tr>
    <tr>
      <th>Parks</th>
      <td>0.434700</td>
      <td>0.429703</td>
      <td>1.000000</td>
      <td>0.392288</td>
      <td>0.131670</td>
      <td>-0.230731</td>
    </tr>
    <tr>
      <th>Transit_stations</th>
      <td>0.727399</td>
      <td>0.582958</td>
      <td>0.392288</td>
      <td>1.000000</td>
      <td>0.632836</td>
      <td>-0.704256</td>
    </tr>
    <tr>
      <th>Workplaces</th>
      <td>0.583437</td>
      <td>0.501260</td>
      <td>0.131670</td>
      <td>0.632836</td>
      <td>1.000000</td>
      <td>-0.914917</td>
    </tr>
    <tr>
      <th>Residential</th>
      <td>-0.714937</td>
      <td>-0.539698</td>
      <td>-0.230731</td>
      <td>-0.704256</td>
      <td>-0.914917</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="visualising-correlation">
<h1>Visualising correlation<a class="headerlink" href="#visualising-correlation" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot a heatmap based on the correlation analysis</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">mobility_trends_UK_corr</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/05_data_exploration_and_visualisation_81_0.png" src="../_images/05_data_exploration_and_visualisation_81_0.png" />
</div>
</div>
<p>We now fit a toy linear regression model using the <code class="docutils literal notranslate"><span class="pre">linregress()</span></code> function from the <code class="docutils literal notranslate"><span class="pre">SciPy.stats</span></code> module. We regress residential mobility on workplaces mobility.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit a linear regression model and store results</span>
<span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r_value</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">mobility_trends_UK</span><span class="p">[</span><span class="s2">&quot;Workplaces&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">mobility_trends_UK</span><span class="p">[</span><span class="s2">&quot;Residential&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r_value</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">std_err</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(nan, nan, nan, nan, nan)
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">linregress()</span></code> failed to return model output. This is because the function does not deal well with Not a Number (NaN) values. A straightforward solution during the exploratory phase of analysis is to remove NaNs. However, other approaches may be more informative at the modelling stage, including mean imputation. We perform mean imputation by replacing missing values of a variable by the mean computed on the non-missing observations of that variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Number of rows and columns in the DataFrame with NaNs</span>
<span class="n">mobility_trends_UK</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(209033, 15)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends_UK_NADrop</span> <span class="o">=</span> <span class="n">mobility_trends_UK</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span>
    <span class="n">subset</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;country_region&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sub_region_1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;date&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Retail_Recreation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Grocery_Pharmacy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Parks&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Transit_stations&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Workplaces&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Residential&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Number of rows and columns in the DataFrame without NaNs</span>
<span class="n">mobility_trends_UK_NADrop</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(150757, 15)
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">dropna()</span></code> function removes one quarter of the rows. In subsequent analysis, it would make sense to impute missing values, including a simple procedure for replacing NaNs with the mean value for that county and mobility category.</p>
<p>Below we fit again a linear regression model using the new DataFrame that contain no NaN values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit a linear regression model and display outputs</span>
<span class="n">model_outputs</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span>
    <span class="n">mobility_trends_UK_NADrop</span><span class="p">[</span><span class="s2">&quot;Workplaces&quot;</span><span class="p">],</span> <span class="n">mobility_trends_UK_NADrop</span><span class="p">[</span><span class="s2">&quot;Residential&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">model_outputs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LinregressResult(slope=-0.35580786753641186, intercept=0.3745693881369405, rvalue=-0.9297780751627193, pvalue=0.0, stderr=0.00036281934265285695)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_outputs</span><span class="o">.</span><span class="n">slope</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.35580786753641186
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="visualising-linear-regression">
<h1>Visualising linear regression<a class="headerlink" href="#visualising-linear-regression" title="Permalink to this headline">¶</a></h1>
<p>We now plot a regression line and 95% confidence interval using the Seaborn <code class="docutils literal notranslate"><span class="pre">regplot</span></code> function. We also include in a legend the correlation coefficient and the actual p-value. The p-value from the linear regression model outputs reads 0. The p-value, however, is never a 0. P-values less than .001 are typically reported as as P&lt;.001, instead of the actual exact p-value. We indicate this in the visualisation below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualise a linear relationship between Workplaces mobility and Residential mobility</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Workplaces&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Residential&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;r = </span><span class="si">{0:.3}</span><span class="s2">, p-value &lt; </span><span class="si">{1:.3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r_value</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">),</span>
    <span class="n">data</span><span class="o">=</span><span class="n">mobility_trends_UK_mean</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Workplaces mean mobility change&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Residential mean mobility change&quot;</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fcf92818520&gt;
</pre></div>
</div>
<img alt="../_images/05_data_exploration_and_visualisation_91_1.png" src="../_images/05_data_exploration_and_visualisation_91_1.png" />
</div>
</div>
<p>We used above the SciPy module to fit a linear least-squares regression model. There is another library in Python, <code class="docutils literal notranslate"><span class="pre">Statsmodels</span></code>, which is widely used for statistical analysis.</p>
<p>For completeness, we fit the same linear least-squares regression model as above using the <code class="docutils literal notranslate"><span class="pre">Statsmodels</span></code> function <code class="docutils literal notranslate"><span class="pre">OLS</span></code>. Recall that we gave the <code class="docutils literal notranslate"><span class="pre">Statsmodels</span></code> library the alias <code class="docutils literal notranslate"><span class="pre">sm</span></code> when we imported the library at the top of the notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Rerun the ordinary least squares (OLS) regression  using the Statsmodels library</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">mobility_trends_UK_NADrop</span><span class="p">[</span><span class="s2">&quot;Workplaces&quot;</span><span class="p">])</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">mobility_trends_UK_NADrop</span><span class="p">[</span><span class="s2">&quot;Residential&quot;</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">results</span>

<span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<span class="n">print_model</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">print_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:            Residential   R-squared:                       0.864
Model:                            OLS   Adj. R-squared:                  0.864
Method:                 Least Squares   F-statistic:                 9.617e+05
Date:                Wed, 04 May 2022   Prob (F-statistic):               0.00
Time:                        09:47:58   Log-Likelihood:            -3.7043e+05
No. Observations:              150757   AIC:                         7.409e+05
Df Residuals:                  150755   BIC:                         7.409e+05
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.3746      0.015     25.247      0.000       0.345       0.404
Workplaces    -0.3558      0.000   -980.675      0.000      -0.357      -0.355
==============================================================================
Omnibus:                     4300.991   Durbin-Watson:                   0.595
Prob(Omnibus):                  0.000   Jarque-Bera (JB):             5567.433
Skew:                          -0.340   Prob(JB):                         0.00
Kurtosis:                       3.651   Cond. No.                         83.4
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="recording-dependencies">
<h1>Recording dependencies<a class="headerlink" href="#recording-dependencies" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install the watermark extension</span>
<span class="o">!</span>pip install -q watermark

<span class="c1"># Load the watermark extension</span>
<span class="o">%</span><span class="k">load_ext</span> watermark

<span class="c1"># Show packages that were imported</span>
<span class="o">%</span><span class="k">watermark</span> --iversions
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>matplotlib : 3.3.2
statsmodels: 0.12.2
scipy      : 1.5.2
seaborn    : 0.11.2
pandas     : 1.1.3
numpy      : 1.19.2
</pre></div>
</div>
</div>
</div>
<p>Save a list of the packages (and their versions) used in the current notebook to a file named <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pipreqsnb ../notebooks/05_data_exploration_and_visualisation.ipynb
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Exception occurred while working on file ../notebooks/05_data_exploration_and_visualisation.ipynb, cell 23/98
Traceback (most recent call last):
  File &quot;/Users/valentindanchev/opt/anaconda3/bin/pipreqsnb&quot;, line 8, in &lt;module&gt;
    sys.exit(main())
  File &quot;/Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages/pipreqsnb/pipreqsnb.py&quot;, line 129, in main
    raise e
  File &quot;/Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages/pipreqsnb/pipreqsnb.py&quot;, line 126, in main
    imports += get_import_string_from_source(source)
  File &quot;/Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages/pipreqsnb/pipreqsnb.py&quot;, line 26, in get_import_string_from_source
    tree = ast.parse(source)
  File &quot;/Users/valentindanchev/opt/anaconda3/lib/python3.8/ast.py&quot;, line 47, in parse
    return compile(source, filename, mode, flags,
  File &quot;&lt;unknown&gt;&quot;, line 1
    sns.catplot?
               ^
SyntaxError: invalid syntax
</pre></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="04_data_design_and_data_wrangling.html" title="previous page">Data Design &amp; Data Wrangling</a>
    <a class='right-next' id="next-link" href="06_pattern_discovery_using_unsupervised_learning.html" title="next page">Discovering patterns in data</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Valentin Danchev<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>