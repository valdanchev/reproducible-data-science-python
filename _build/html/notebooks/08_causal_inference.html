
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Introduction to Causal Inference &#8212; Reproducible Data Science + Python + Real-World Data</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e7340bb3dbd8dde6db86f25597f54a1b.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Network analysis with NetworkX" href="09_network_analysis.html" />
    <link rel="prev" title="Learning from Data to Predict" href="07_prediction_using_supervised_learning.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Reproducible Data Science + Python + Real-World Data</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Reproducible Data Science with Python
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  About the textbook
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="00_textbook_outline.html">
   Textbook outline
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="00_textbook_outline.html#what-is-reproducible-data-science">
   What is Reproducible Data Science?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="00_textbook_outline.html#learning-objectives">
   Learning objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="00_textbook_outline.html#learning-resources">
   Learning resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="00_textbook_outline.html#software-stack">
   Software stack
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="00_textbook_outline.html#data-sets">
   Data sets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="00_textbook_outline.html#how-to-get-the-most-of-the-open-learning-resource">
   How to get the most of the open learning resource?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="00_textbook_outline.html#acknowledgment">
   Acknowledgment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="00_textbook_outline.html#code-availability">
   Code availability
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  End-to-End Data Science Project
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html">
   Human mobility during UK lockdowns
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#let-s-formulate-our-research-question">
   Let’s formulate our research question
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#data-to-address-the-question">
   Data to address the question
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#get-started-with-jupyter-colab-notebook">
   Get started with Jupyter/Colab notebook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#let-s-get-coding">
   Let’s get coding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#python-tools-for-data-analysis">
   Python tools for data analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#load-your-data">
   Load your data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#view-your-data">
   View your data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#data-design-how-are-data-generated">
   Data Design: How are data generated?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#data-ethics-privacy-and-fairness-risks">
   Data Ethics, Privacy, and Fairness Risks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#describe-your-data">
   Describe your data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#exploratory-data-analysis">
   Exploratory data analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#data-wrangling">
   Data wrangling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#visualising-mobility-trends">
   Visualising mobility trends
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#mobility-changes-across-lockdowns">
   Mobility changes across lockdowns
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#zooming-in-regional-mobility-trends">
   Zooming in: Regional mobility trends
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_end_to_end_data_science_project.html#re-cap">
   Re-cap
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Python Data Science on the Cloud
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html">
   <strong>
    Python for Data Analysis on the Cloud
   </strong>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html#get-started-with-jupyter-colab-notebooks">
   Get Started with Jupyter &amp; Colab notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html#python-coding-for-data-analysis">
   Python Coding for Data Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html#descriptive-statistics-with-numpy">
   Descriptive statistics with
   <code class="docutils literal notranslate">
    <span class="pre">
     NumPy
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html#getting-help">
   Getting help
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html#readability-of-your-python-code">
   Readability of your Python code
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html#running-command-line-commands-in-jupyter-colab-notebook">
   Running command-line commands in Jupyter/Colab notebook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html#installing-packages-with-pip">
   Installing packages with
   <code class="docutils literal notranslate">
    <span class="pre">
     pip
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html#jupyter-magic-commands">
   Jupyter magic commands
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html#loading-real-world-data-with-pandas">
   Loading real-world data with
   <code class="docutils literal notranslate">
    <span class="pre">
     pandas
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html#hands-on-exercise-let-s-practice-your-python-skills">
   Hands-on exercise: Let’s practice your Python skills
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html#markdown-text-cells">
   Markdown Text Cells
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_python_data_science_on_the_cloud.html#hands-on-exercise-let-s-practice-your-markdown-skills">
   Hands-on exercise: Let’s practice your Markdown skills
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Open Reproducible Workflow
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="03_open_reproducible_workflows.html">
   Open Reproducible Data Science Workflow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_open_reproducible_workflows.html#what-is-computational-reproducibility-and-why-it-matters">
   What is computational reproducibility and why it matters?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_open_reproducible_workflows.html#open-reproducible-workflow-in-jupyter-colab-notebooks">
   Open Reproducible Workflow in Jupyter/Colab Notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_open_reproducible_workflows.html#rules-for-reproducible-workflow">
   Rules for Reproducible Workflow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_open_reproducible_workflows.html#reproducible-research-report">
   Reproducible research report
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_open_reproducible_workflows.html#recording-dependencies">
   Recording dependencies
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  data design &amp; data wrangling
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="04_data_design_and_data_wrangling.html">
   Data Design &amp; Data Wrangling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_data_design_and_data_wrangling.html#get-started-with-pandas">
   Get started with
   <code class="docutils literal notranslate">
    <span class="pre">
     pandas
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_data_design_and_data_wrangling.html#importing-pandas">
   Importing
   <code class="docutils literal notranslate">
    <span class="pre">
     pandas
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_data_design_and_data_wrangling.html#loading-your-data">
   Loading your data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_data_design_and_data_wrangling.html#loading-covid-19-data-sets-via-url">
   Loading Covid-19 data sets via URL
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_data_design_and_data_wrangling.html#viewing-describing-and-accessing-your-data">
   Viewing, Describing, and Accessing your Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_data_design_and_data_wrangling.html#accessing-columns-and-rows-in-your-data">
   Accessing columns and rows in your data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_data_design_and_data_wrangling.html#hands-on-exercise">
   Hands-on exercise
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_data_design_and_data_wrangling.html#handling-missing-values">
   Handling Missing Values
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_data_design_and_data_wrangling.html#compare-mobility-data-formats">
   Compare mobility data formats
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_data_design_and_data_wrangling.html#recording-dependencies">
   Recording dependencies
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Data Exploration &amp; Visualisation
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html">
   Exploratory Data Analysis and Visualisation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#learning-resources">
   Learning resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#addressing-simple-questions-via-python-eda">
   Addressing simple questions via Python EDA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#code-reuse-creating-your-own-functions">
   Code reuse: creating your own functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#rq1-how-do-countries-differ-in-mobility-trends">
   RQ1: How do countries differ in mobility trends?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#data-visualisation-with-seaborn">
   Data visualisation with Seaborn
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#changing-figure-appearance">
   Changing figure appearance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#wide-and-long-data-format">
   Wide and long data format
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#multi-plot-visualisations">
   Multi-plot visualisations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#hands-on-exercise">
   Hands-on exercise
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#rq2-how-do-mobility-trends-change-over-time">
   RQ2: How do mobility trends change over time?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#visualising-time-series-data">
   Visualising time series data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#bootstrapping-for-inference">
   Bootstrapping for inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#rq3-how-have-mobility-trends-differed-across-uk-lockdowns">
   RQ3: How have mobility trends differed across UK lockdowns?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#visualising-lockdowns-mobility-as-barplots">
   Visualising lockdowns’ mobility as barplots
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#rq4-how-have-mobility-trends-differed-across-uk-counties-during-the-third-lockdown">
   RQ4: How have mobility trends differed across UK counties during the third lockdown?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#id1">
   Multi-plot visualisations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#split-apply-combine">
   Split-apply-combine
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#summarising-data-by-groups">
   Summarising data by groups
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#rq5-how-do-mobility-categories-relate-to-each-other">
   RQ5: How do mobility categories relate to each other?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#visualising-distributions">
   Visualising distributions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#plotting-pairwise-relationships">
   Plotting pairwise relationships
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#rq6-how-correlated-are-mobility-categories-across-uk-counties">
   RQ6: How correlated are mobility categories across UK counties?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#visualising-correlation">
   Visualising correlation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#visualising-linear-regression">
   Visualising linear regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_data_exploration_and_visualisation.html#recording-dependencies">
   Recording dependencies
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Pattern Discovery using Unsupervised Learning
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html">
   Discovering patterns in data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#machine-learning-what-is-it-what-is-it-good-for">
   Machine Learning: What is it? What is it good for?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#research-problem-clustering-counties-by-mobility">
   Research problem: clustering counties by mobility
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#k-means-clustering">
   <em>
    k
   </em>
   -means clustering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#let-s-get-coding-with-scikit-learn">
   Let’s get coding with
   <code class="docutils literal notranslate">
    <span class="pre">
     scikit-learn
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#data-preprocessing">
   Data preprocessing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#data-standardisation">
   Data standardisation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#choosing-the-optimal-number-of-clusters">
   Choosing the optimal number of clusters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#performing-for-loop">
   Performing
   <code class="docutils literal notranslate">
    <span class="pre">
     for
    </span>
   </code>
   loop
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#elbow-plot">
   Elbow plot
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#dimensionality-reduction-via-pca">
   Dimensionality Reduction via PCA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#visualising-mobility-clusters">
   Visualising mobility clusters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#related-approaches-hierarchical-clustering">
   Related approaches: Hierarchical clustering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pattern_discovery_using_unsupervised_learning.html#hands-on-exercise">
   Hands-on exercise
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Prediction using Supervised Learning
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html">
   Learning from Data to Predict
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#the-prediction-task">
   The Prediction task
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#prediction-tasks-in-social-sciences">
   Prediction tasks in social sciences
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#predictions-gone-wrong">
   Predictions gone wrong
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#supervised-learning">
   Supervised learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#research-problem-vaccine-hesitancy">
   Research problem: vaccine hesitancy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#data-understanding-society-covid-19">
   Data: Understanding Society COVID-19
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#defining-output-and-input-variables">
   Defining Output and Input variables
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#data-wrangling">
   Data wrangling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#overfitting-and-data-splitting">
   Overfitting and data splitting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#preprocessing-the-training-data-set">
   Preprocessing the training data set
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#unbalance-class-problem">
   Unbalance class problem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#train-models-on-training-data">
   Train models on training data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#model-evaluation-using-cross-validation">
   Model evaluation using Cross-validation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#testing-model-accuracy-on-new-data">
   Testing model accuracy on new data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#preprocessing-the-test-data-set">
   Preprocessing the test data set
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#predicting-vaccine-hesitancy">
   Predicting vaccine hesitancy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_prediction_using_supervised_learning.html#model-evaluation-on-test-data">
   Model evaluation on test data
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Causal Inference
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Introduction to Causal Inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#what-causes-what">
   What causes what?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#confoundingbasic-definitions">
   Confounding—basic definitions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#our-example-of-collider-bias">
   Our example of collider bias
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#drawing-causal-graphs">
   Drawing causal graphs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#statistical-models-in-python">
   Statistical Models in Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#collider-confounder">
   Collider confounder
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#using-weights-to-correct-for-complex-sample-design">
   Using weights to correct for complex sample design
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#additional-material">
   Additional material
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#gender-discrimination-and-collider-bias">
   Gender discrimination and collider bias
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#references">
   References
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Network Analysis
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="09_network_analysis.html">
   Network analysis with NetworkX
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_network_analysis.html#open-network-data-repositories">
   Open network data repositories
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_network_analysis.html#network-representations">
   Network representations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_network_analysis.html#creating-an-undirected-network">
   Creating an undirected network
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_network_analysis.html#computing-network-diagnostics">
   Computing network diagnostics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_network_analysis.html#assortative-mixing">
   Assortative mixing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_network_analysis.html#creating-a-directed-network">
   Creating a directed network
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_network_analysis.html#a-fun-examplestar-wars-network">
   A fun example—Star Wars network
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_network_analysis.html#global-network-diagnostics">
   Global network diagnostics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_network_analysis.html#meso-scale-network-diagnostics">
   Meso-scale network diagnostics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_network_analysis.html#local-network-diagnostics">
   Local network diagnostics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_network_analysis.html#references">
   References
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Data ethics
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="10_data_ethics.html">
   Data Ethics, Bias, and Fairness
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10_data_ethics.html#discussion-a-level-results-in-2020-england">
   Discussion: A-level results in 2020 England
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10_data_ethics.html#learning-resources-about-the-a-level-controversy">
   Learning resources about the A-level controversy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10_data_ethics.html#bias-and-fairness-in-data-science-systems">
   Bias and Fairness in Data Science Systems
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/08_causal_inference.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/valdanchev/reproducible-data-science-python"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/valdanchev/reproducible-data-science-python/issues/new?title=Issue%20on%20page%20%2Fnotebooks/08_causal_inference.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/valdanchev/reproducible-data-science-python/master?urlpath=tree/notebooks/08_causal_inference.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Introduction to Causal Inference
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-causes-what">
   What causes what?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#learning-resources">
     Learning resources
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#confoundingbasic-definitions">
   Confounding—basic definitions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#definitions">
     Definitions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#our-example-of-collider-bias">
   Our example of collider bias
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#drawing-causal-graphs">
   Drawing causal graphs
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#statistical-models-in-python">
   Statistical Models in Python
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#collider-confounder">
   Collider confounder
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#variables">
     Variables
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-weights-to-correct-for-complex-sample-design">
   Using weights to correct for complex sample design
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#questions">
     Questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#additional-material">
   Additional material
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gender-discrimination-and-collider-bias">
   Gender discrimination and collider bias
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="introduction-to-causal-inference">
<h1>Introduction to Causal Inference<a class="headerlink" href="#introduction-to-causal-inference" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="what-causes-what">
<h1>What causes what?<a class="headerlink" href="#what-causes-what" title="Permalink to this headline">¶</a></h1>
<p>Observational data (i.e., data recorded from human activity) and big data sources in particular are rife with spurious correlations between variables that appear to be associated in a model but are not causally linked. As a result, many models would pick some interesting associations in the data, which may appear statistically significant but likely lack practical significance. If the goal is to implement a new policy or interventions that may introduce change in the social world, we need knowledge about the underlying causal structure of the problem — what causes what. Specifically, we would like to know the effect of a particular <em>treatment</em> (any policy or intervention, for example, Work from Home) on an <em>Outcome</em> (for example, Number of coronavirus cases) and compare the observed effect to a counterfactual question, for example, ‘What would have been the Number of coronavirus cases if a Work from home policy was not introduced?’.</p>
<p>Causal graphs or DAGs (Directed Acyclical Graphs) are a useful tool for drawing intuitive pictures that:</p>
<ul class="simple">
<li><p>Reflect our assumptions about our treatment, outcome, and associated factors.</p></li>
<li><p>Highlight possible sources of bias (e.g., confounding) which may otherwise be unnoticed.</p></li>
<li><p>Improve our data analysis for causal inference.</p></li>
</ul>
<p>In a causal graph (see Figure 1 below), each variable has a corresponding node, and the arrows reflect the direction of causation we assume of the basis of domain knowledge.</p>
<div class="section" id="learning-resources">
<h2>Learning resources<a class="headerlink" href="#learning-resources" title="Permalink to this headline">¶</a></h2>
<p><i class="fas fa-book"></i> <i class="fas fa-code"></i> Scott Cunningham. <a class="reference external" href="https://mixtape.scunning.com/dag.html">Chapter 3: Directed Acyclical Graphs</a> in <a class="reference external" href="https://mixtape.scunning.com/index.html">Causal Inference: The Mixtape.</a> Yale University Press.</p>
<p><i class="fas fa-book"></i> <i class="fas fa-code"></i> <i class="fas fa-play-circle"></i> <a class="reference external" href="https://xcelab.net/rm/statistical-rethinking/">Chapter 6. The Haunted DAG &amp; The Causal Terror</a> in Richard McElreath’s Statistical Rethinking book and associated <a class="reference external" href="https://www.youtube.com/watch?v=l_7yIUqWBmE">video lecture</a>.</p>
<p><i class="fas fa-play-circle"></i> Miguel Hernán. <a class="reference external" href="https://www.edx.org/course/causal-diagrams-draw-your-assumptions-before-your">Causal Diagrams: Draw Your Assumptions Before Your Conclusions</a>. edX.</p>
<p><i class="fas fa-book"></i> Kosuke Imai. <a class="reference external" href="http://assets.press.princeton.edu/chapters/s2-11025.pdf">Chapter 2: Causality</a> in Quantitative Social Science. Princeton University Press.</p>
<p><i class="fas fa-book"></i> Stephen L. Morgan and Christopher Winship. Counterfactuals and Causal Inference. Cambridge University Press.</p>
<p><i class="fas fa-book"></i> Hernán MA, Robins JM (2020). <a class="reference external" href="https://cdn1.sph.harvard.edu/wp-content/uploads/sites/1268/2021/03/ciwhatif_hernanrobins_30mar21.pdf">Causal Inference: What If.</a> Boca Raton: Chapman &amp; Hall/CRC.</p>
<p><i class="fas fa-scroll"></i> Miguel Hernán, John Hsu, and Brian Healy. <a class="reference external" href="https://amstat.tandfonline.com/doi/pdf/10.1080/09332480.2019.1579578?needAccess=true">A Second Chance to Get Causal Inference Right: A Classification of Data Science Tasks.</a> CHANCE.</p>
</div>
</div>
<div class="section" id="confoundingbasic-definitions">
<h1>Confounding—basic definitions<a class="headerlink" href="#confoundingbasic-definitions" title="Permalink to this headline">¶</a></h1>
<p>To keep things concrete, in this lab, we will use DAGs to shed some light on the problem of confounding with a focus on two common confounds: (2) the fork and (3) the collider. In particular, we will discuss the collider confound as the ‘fork’ confound is typically well understood in the social sciences.</p>
<div class="section" id="definitions">
<h2>Definitions<a class="headerlink" href="#definitions" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>Confounding</strong>: any interference such that the effect of predictors X on an outcome of interest Y is not the same as it would have been had we experimentally determined the predictors X. In experimental settings, we have treatment and control groups that are comparable with respect to every characteristic related to the outcome with the only difference being that the treatment group received the treatment and the control group did not.</p>
<ul>
<li><p><strong>Fork</strong>: A variable Y is a common cause of X and Z, inducing a spurious correlation between them. This is the most common example of confounding (see <a class="reference external" href="https://assets.press.princeton.edu/chapters/s2-11025.pdf">Kosuke Imai’s Quantitative Social Science, page 57</a>).</p></li>
<li><p><strong>Collider</strong>: Relationship between X and Z does not exist unless we condition on Y, which is a collider variable (because the paths from X and Z collide in Y).</p></li>
</ul>
</li>
</ul>
<img src="https://miro.medium.com/max/4800/1*bmORaFV5mKqUTaML7ib_Rw.png" width="600" height="300"/>
<p>Figure 1. <a class="reference external" href="https://medium.com/&#64;akelleh/a-technical-primer-on-causality-181db2575e41">DAG representation</a> of fork (left) and collider (right). Source: <a class="reference external" href="https://medium.com/&#64;akelleh/a-technical-primer-on-causality-181db2575e41">A Technical Primer On Causality</a> by Adam Kelleher.</p>
</div>
</div>
<div class="section" id="our-example-of-collider-bias">
<h1>Our example of collider bias<a class="headerlink" href="#our-example-of-collider-bias" title="Permalink to this headline">¶</a></h1>
<p>Many canonical examples of collider bias exist in the literature, but we will develop our own example using a data set we know well — the Understanding Society Covid-19 survey data.</p>
<p>Consider a situation in which both variables Working from home and Age have an effect on the Risk of getting Covid-19 but are not correlated between each other in the entire data set. Then we condition on the respondents who considered the risk for getting Covid-19 ‘Very likely’ as an example of problematic conditioning on a collider variable. After this problematic conditioning, we observe a strong negative relationship between Age and Work from home. In short, Work from home and Age are not correlated in the population but get correlated once conditioning on perceived very high risk of getting Covid-19, introducing collider bias. Of course, in this example we use survey data, and not many would condition on ‘Very likely’ risk of getting Covid-19, but in many observational data sets, we may have data only about a pre-selected subset of the population so our data may contain such problematic selection, introducing collider bias, by design.</p>
</div>
<div class="section" id="drawing-causal-graphs">
<h1>Drawing causal graphs<a class="headerlink" href="#drawing-causal-graphs" title="Permalink to this headline">¶</a></h1>
<p>To visualise our example as a causal graph, we will use the R package <a class="reference external" href="https://cran.r-project.org/web/packages/ggdag/ggdag.pdf"><code class="docutils literal notranslate"><span class="pre">ggdag</span></code></a>. This <a class="reference external" href="https://cran.r-project.org/web/packages/ggdag/vignettes/bias-structures.html">tutorial</a> by Malcolm Barrett gives a good overview of <code class="docutils literal notranslate"><span class="pre">ggdag</span></code> and its capabilities.</p>
<p>In order to run R in a Python Jupyter, we need to install the <code class="docutils literal notranslate"><span class="pre">rpy2</span></code> package which provides Python interface to the R language.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install rpy2

<span class="c1"># To enable the %%R cell magic command, which turns a cell to be</span>
<span class="c1"># interpreted as an R code, we execute %load_ext rpy2.ipython.</span>
<span class="o">%</span><span class="k">load_ext</span> rpy2.ipython
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: rpy2 in /Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages (3.3.6)
Requirement already satisfied: pytest in /Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages (from rpy2) (6.2.4)
Requirement already satisfied: tzlocal in /Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages (from rpy2) (2.1)
Requirement already satisfied: jinja2 in /Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages (from rpy2) (2.11.2)
Requirement already satisfied: pytz in /Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages (from rpy2) (2020.4)
Requirement already satisfied: cffi&gt;=1.10.0 in /Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages (from rpy2) (1.14.4)
Requirement already satisfied: pycparser in /Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages (from cffi&gt;=1.10.0-&gt;rpy2) (2.20)
Requirement already satisfied: MarkupSafe&gt;=0.23 in /Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages (from jinja2-&gt;rpy2) (1.1.1)
Requirement already satisfied: toml in /Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages (from pytest-&gt;rpy2) (0.10.1)
Requirement already satisfied: py&gt;=1.8.2 in /Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages (from pytest-&gt;rpy2) (1.9.0)
Requirement already satisfied: pluggy&lt;1.0.0a1,&gt;=0.12 in /Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages (from pytest-&gt;rpy2) (0.13.1)
Requirement already satisfied: attrs&gt;=19.2.0 in /Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages (from pytest-&gt;rpy2) (20.3.0)
Requirement already satisfied: packaging in /Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages (from pytest-&gt;rpy2) (20.7)
Requirement already satisfied: iniconfig in /Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages (from pytest-&gt;rpy2) (1.1.1)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: pyparsing&gt;=2.0.2 in /Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages (from packaging-&gt;pytest-&gt;rpy2) (2.4.7)
</pre></div>
</div>
</div>
</div>
<p>Now we can run R code in a cell by adding the R cell magic command <code class="docutils literal notranslate"><span class="pre">%%R</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
# install.packages(&#39;ggdag&#39;) # you will need to select a CRAN mirror from where
# to install the package; for example, typing in &#39;70&#39; will select UK London
library(ggdag)
theme_set(theme_dag())
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>R[write to console]: Loading required package: ggplot2
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>R[write to console]: 
Attaching package: ‘ggdag’
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>R[write to console]: The following object is masked from ‘package:stats’:

    filter
</pre></div>
</div>
</div>
</div>
<p>Import the <code class="docutils literal notranslate"><span class="pre">ggdag</span></code> package.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
library(ggdag)
theme_set(theme_dag())
</pre></div>
</div>
</div>
</div>
<p>In our model, we assume that both variables <em>Work from home</em> and <em>Age</em> affect the outcome variable, <em>Risk of getting Covid-19</em>. We also assume that <em>Working at home</em> and <em>Age</em> are not causally connected. Below we represent our simple model using a causal graph. The node where <em>Work from home</em> and <em>Age</em> arrowheads meet is called a collider, meaning that both variables collide there. Let’s now plot a causal graph with our three variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
RiskCovid_dag &lt; -collider_triangle(
    x=&quot;Not Work from Home&quot;, y=&quot;Age&quot;, m=&quot;Perceived risk from getting Covid-19&quot;
)

ggdag(RiskCovid_dag, text=FALSE, use_labels=&quot;label&quot;, node_size=20, text_size=6)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>R[write to console]: Error in withVisible({ : object &#39;RiskCovid_dag&#39; not found
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Error in withVisible({ : object &#39;RiskCovid_dag&#39; not found
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
ggdag_dseparated(RiskCovid_dag, text=FALSE, use_labels=&quot;label&quot;, text_size=6)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>R[write to console]: Error in is.tidy_dagitty(.dagitty) : object &#39;RiskCovid_dag&#39; not found
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Error in is.tidy_dagitty(.dagitty) : object &#39;RiskCovid_dag&#39; not found
</pre></div>
</div>
</div>
</div>
<p>Although Work from home and Age are not correlated in the population, they may get correlated once we condition on Very high risk of getting Covid-19. The square shape of the variable <em>Risk of getting Covid-19</em> indicates that we condition on that variable being a certain value, in our case on people with Very high perceived risk of getting Covid-19.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
ggdag_dseparated(
    RiskCovid_dag, controlling_for=&quot;m&quot;, text=FALSE, use_labels=&quot;label&quot;, text_size=6
)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>R[write to console]: Error in is.tidy_dagitty(.dagitty) : object &#39;RiskCovid_dag&#39; not found
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Error in is.tidy_dagitty(.dagitty) : object &#39;RiskCovid_dag&#39; not found
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="statistical-models-in-python">
<h1>Statistical Models in Python<a class="headerlink" href="#statistical-models-in-python" title="Permalink to this headline">¶</a></h1>
<p>We will now perform our analysis to see how conditioning in a model can introduce a collider bias.</p>
<p>In this lab, we will use the Python library <a class="reference external" href="https://www.statsmodels.org/devel/examples/index.html"><code class="docutils literal notranslate"><span class="pre">statsmodels</span></code></a>. <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> is a Python module that provides functions for the estimation of many different statistical models.</p>
<img src="https://www.statsmodels.org/devel/_images/statsmodels-logo-v2-horizontal.svg" width="400" height="200"/>
<p>You can install <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> by running the following command:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install statsmodels
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: statsmodels in /Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages (0.12.2)
Requirement already satisfied: pandas&gt;=0.21 in /Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages (from statsmodels) (1.4.3)
Requirement already satisfied: patsy&gt;=0.5 in /Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages (from statsmodels) (0.5.1)
Requirement already satisfied: numpy&gt;=1.15 in /Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages (from statsmodels) (1.19.2)
Requirement already satisfied: scipy&gt;=1.1 in /Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages (from statsmodels) (1.5.2)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: python-dateutil&gt;=2.8.1 in /Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages (from pandas&gt;=0.21-&gt;statsmodels) (2.8.1)
Requirement already satisfied: pytz&gt;=2020.1 in /Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages (from pandas&gt;=0.21-&gt;statsmodels) (2020.4)
Requirement already satisfied: six in /Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages (from patsy&gt;=0.5-&gt;statsmodels) (1.15.0)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="collider-confounder">
<h1>Collider confounder<a class="headerlink" href="#collider-confounder" title="Permalink to this headline">¶</a></h1>
<p>We will use data from <a class="reference external" href="https://www.understandingsociety.ac.uk/topic/covid-19">Understanding Society COVID-19</a> (Wave 6, November 2020, web collected) to demonstrate the causal structure of collider confounder. The data are safeguarded and can be accessed via the <a class="reference external" href="https://beta.ukdataservice.ac.uk/datacatalogue/studies/study?id=8644">UK Data Service</a>. Once access to the data is obtained, the data needs to be stored securely in your Google Drive and loaded in your private Colab notebook. The data is provided in various file formats, we use the <code class="docutils literal notranslate"><span class="pre">.tab</span></code> file format (<code class="docutils literal notranslate"><span class="pre">tab</span></code> files store data values separated by tabs) which can be easily loaded using <code class="docutils literal notranslate"><span class="pre">pandas</span></code>. Specifically, the web collected data of the survey from Wave 6 (November 2020) is stored in the file <code class="docutils literal notranslate"><span class="pre">cf_indresp_w.tab</span></code>. Let’s load the survey data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the Drive helper</span>
<span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">drive</span>

<span class="c1"># This will prompt for authorization.</span>
<span class="c1"># Enter your authorisation code and rerun the cell.</span>
<span class="n">drive</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s2">&quot;/content/drive&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-8-71de872a6421&gt;</span> in <span class="ni">&lt;cell line: 2&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Import the Drive helper</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">drive</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> 
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="c1"># This will prompt for authorization.</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="c1"># Enter your authorisation code and rerun the cell.</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;google&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Load the Understadning Society COVID-19 Study web collected data, Wave 6</span>
<span class="c1"># Set the delimeter parameter sep to &quot;\t&quot; which indicates tabs</span>
<span class="n">USocietyCovid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">&quot;/content/drive/My Drive/cf_indresp_w.tab&quot;</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display headings only as the data is safeguarded</span>
<span class="n">USocietyCovid</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pidp</th>
      <th>psu</th>
      <th>strata</th>
      <th>birthy</th>
      <th>racel_dv</th>
      <th>bornuk_dv</th>
      <th>i_hidp</th>
      <th>j_hidp</th>
      <th>k_hidp</th>
      <th>i_ioutcome</th>
      <th>...</th>
      <th>cf_ff_intm</th>
      <th>cf_ff_inty</th>
      <th>cf_ff_country</th>
      <th>cf_gor_dv</th>
      <th>cf_aid_dv</th>
      <th>cf_betaindin_xw</th>
      <th>cf_betaindin_xw_t</th>
      <th>cf_betaindin_lw</th>
      <th>cf_betaindin_lw_t1</th>
      <th>cf_betaindin_lw_t2</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
<p>0 rows × 915 columns</p>
</div></div></div>
</div>
<div class="section" id="variables">
<h2>Variables<a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h2>
<p>To make things concrete, let’s select three variables.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Variable in Our Model</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Variable Name</p></th>
<th class="head"><p>Values</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>X</p></td>
<td><p>Working at home</p></td>
<td><p>cf_wah</p></td>
<td><p>1 = Always, 2 = Often, 3 = Sometimes, 4 = Never</p></td>
</tr>
<tr class="row-odd"><td><p>Z</p></td>
<td><p>Age</p></td>
<td><p>cf_age</p></td>
<td><p>Integer values (whole numbers)</p></td>
</tr>
<tr class="row-even"><td><p>Y</p></td>
<td><p>Risk of getting covid19</p></td>
<td><p>cf_riskcv19</p></td>
<td><p>1 = Very likely, 2 = Likely, 3 = Unlikely, 4 = Very unlikely</p></td>
</tr>
</tbody>
</table>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select and preprocesses our variables from the Understanding Society Study.</span>
<span class="c1"># We also select the weighting variable cf_betaindin_xw we will use later (see  </span>
<span class="c1"># section &#39;Weighting to correct for complex sample design&#39; below)</span>

<span class="n">USocietyCovidCollider</span> <span class="o">=</span> <span class="n">USocietyCovid</span><span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;cf_wah&quot;</span><span class="p">,</span> <span class="s2">&quot;cf_age&quot;</span><span class="p">,</span> <span class="s2">&quot;cf_riskcv19&quot;</span><span class="p">,</span> <span class="s2">&quot;cf_betaindin_xw&quot;</span><span class="p">]</span>
<span class="p">]</span>
<span class="n">USocietyCovidCollider</span> <span class="o">=</span> <span class="n">USocietyCovidCollider</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">USocietyCovidCollider</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">USocietyCovidCollider</span> <span class="o">=</span> <span class="n">USocietyCovidCollider</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">USocietyCovidCollider</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cf_wah</th>
      <th>cf_age</th>
      <th>cf_riskcv19</th>
      <th>cf_betaindin_xw</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>37.0</td>
      <td>4.0</td>
      <td>0.502242</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>55.0</td>
      <td>3.0</td>
      <td>0.138687</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2.0</td>
      <td>38.0</td>
      <td>4.0</td>
      <td>0.485160</td>
    </tr>
    <tr>
      <th>5</th>
      <td>4.0</td>
      <td>63.0</td>
      <td>3.0</td>
      <td>0.788910</td>
    </tr>
    <tr>
      <th>6</th>
      <td>3.0</td>
      <td>56.0</td>
      <td>4.0</td>
      <td>0.705270</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>12026</th>
      <td>3.0</td>
      <td>41.0</td>
      <td>3.0</td>
      <td>0.016283</td>
    </tr>
    <tr>
      <th>12028</th>
      <td>4.0</td>
      <td>39.0</td>
      <td>3.0</td>
      <td>0.025795</td>
    </tr>
    <tr>
      <th>12029</th>
      <td>1.0</td>
      <td>41.0</td>
      <td>4.0</td>
      <td>0.285402</td>
    </tr>
    <tr>
      <th>12030</th>
      <td>1.0</td>
      <td>57.0</td>
      <td>4.0</td>
      <td>0.020726</td>
    </tr>
    <tr>
      <th>12034</th>
      <td>1.0</td>
      <td>41.0</td>
      <td>3.0</td>
      <td>2.750525</td>
    </tr>
  </tbody>
</table>
<p>6683 rows × 4 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Work at home versus risk of getting covid</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s2">&quot;notebook&quot;</span><span class="p">,</span> <span class="n">font_scale</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;cf_wah&quot;</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span>
    <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;cf_riskcv19&quot;</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">aspect</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
    <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;ch:.25&quot;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">USocietyCovidCollider</span><span class="p">,</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Change the labels of the horizontal x axis</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Working at home&quot;</span><span class="p">)</span>

<span class="c1"># Add informative labels to the horizontal x axis</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;Always&quot;</span><span class="p">,</span> <span class="s2">&quot;Often&quot;</span><span class="p">,</span> <span class="s2">&quot;Sometimes&quot;</span><span class="p">,</span> <span class="s2">&quot;Never&quot;</span><span class="p">])</span>

<span class="c1"># Change title and labels of the legend</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Risk of getting COVID-19&quot;</span><span class="p">,</span>
    <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Very likely&quot;</span><span class="p">,</span> <span class="s2">&quot;Likely&quot;</span><span class="p">,</span> <span class="s2">&quot;Unlikely&quot;</span><span class="p">,</span> <span class="s2">&quot;Very unlikely&quot;</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f86987b82e0&gt;
</pre></div>
</div>
<img alt="../_images/08_causal_inference_21_1.png" src="../_images/08_causal_inference_21_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Risk of getting COVID-19 versus age</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;cf_riskcv19&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;cf_age&quot;</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;box&quot;</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">aspect</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>  <span class="c1"># control plot size</span>
    <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># set different y axes for each plot</span>
    <span class="n">data</span><span class="o">=</span><span class="n">USocietyCovidCollider</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Add informative labels to the horizontal x axis</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Risk of getting COVID-19&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;Very likely&quot;</span><span class="p">,</span> <span class="s2">&quot;Likely&quot;</span><span class="p">,</span> <span class="s2">&quot;Unlikely&quot;</span><span class="p">,</span> <span class="s2">&quot;Very unlikely&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.FacetGrid at 0x7f8698594f10&gt;
</pre></div>
</div>
<img alt="../_images/08_causal_inference_22_1.png" src="../_images/08_causal_inference_22_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute the mean of the three variables of interest</span>
<span class="n">USocietyCovidCollider</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>cf_wah          2.788867
cf_age         47.494538
cf_riskcv19     3.069280
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute the correlation of the three variables of interest</span>
<span class="n">USocietyCovidCollider</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cf_wah</th>
      <th>cf_age</th>
      <th>cf_riskcv19</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>cf_wah</th>
      <td>1.000000</td>
      <td>-0.013254</td>
      <td>-0.138858</td>
    </tr>
    <tr>
      <th>cf_age</th>
      <td>-0.013254</td>
      <td>1.000000</td>
      <td>0.099640</td>
    </tr>
    <tr>
      <th>cf_riskcv19</th>
      <td>-0.138858</td>
      <td>0.099640</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="using-weights-to-correct-for-complex-sample-design">
<h1>Using weights to correct for complex sample design<a class="headerlink" href="#using-weights-to-correct-for-complex-sample-design" title="Permalink to this headline">¶</a></h1>
<p>Before we perform data analysis, we need to consider the sample of the Understanding Society COVID-19 Study and the importance of using weights in our analysis. The sample of the Understanding Society COVID-19 Study has a clustered and stratified design with certain types of people being over-represented in the sample by design. For example, the study over-samples ethnic minorities. This complex design allows various research analyses across different population sub-groups and topics but posses also a challenge as the sample does not reflect the population structure. To correctly reflect the population structure, we need to use weights in our analysis. The weights correct for unequal selection probability and other conditions (e.g., non-response).</p>
<p>The Understanding Society team provides a number of weights reflecting the structure of the data. For the Understanding Society data we use (cross-sectional web-collected survey data from Wave 6, November 2020), the relevant weights variables is <code class="docutils literal notranslate"><span class="pre">cf_betaindin_xw</span></code>. The name of the weight variable reflects the wave for which the weight is calculated (<code class="docutils literal notranslate"><span class="pre">cf</span></code> refers to Wave 6), level of analysis (<code class="docutils literal notranslate"><span class="pre">indin</span></code> refers to individual interview), and data source (<code class="docutils literal notranslate"><span class="pre">xw</span></code> refers to cross-sectional analysis weight).</p>
<p>Weighting in <em>Understanding Society</em> is discussed in the following sources:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.understandingsociety.ac.uk/sites/default/files/downloads/documentation/covid-19/user-guides/covid-19-user-guide.pdf">Understanding Society COVID-19. User Guide. Version 10.0. December 2021.</a></p></li>
<li><p><a class="reference external" href="https://www.understandingsociety.ac.uk/sites/default/files/downloads/documentation/user-guides/mainstage/weighting_faqs.pdf">Weighting and Sample Representation: Frequently Asked Questions.
Version 1.0. October 2019.</a></p></li>
</ul>
<p>We use <a class="reference external" href="https://www.statsmodels.org/dev/generated/statsmodels.stats.weightstats.DescrStatsW.html"><code class="docutils literal notranslate"><span class="pre">DescrStatsW</span></code></a> from the library <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> to compute descriptive statistics and tests with weights for case weights:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import DescrStatsW</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.weightstats</span> <span class="kn">import</span> <span class="n">DescrStatsW</span>

<span class="c1"># Create a weighted instance using the cf_betaindin_xw weights</span>
<span class="n">USocietyCovidCollider_Weighted</span> <span class="o">=</span> <span class="n">DescrStatsW</span><span class="p">(</span>
    <span class="n">USocietyCovidCollider</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span>
    <span class="n">weights</span><span class="o">=</span><span class="n">USocietyCovidCollider</span><span class="o">.</span><span class="n">cf_betaindin_xw</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute weighted mean of the three variables of interest</span>
<span class="c1"># using the mean attribute in statsmodels</span>
<span class="n">USocietyCovidCollider_Weighted</span><span class="o">.</span><span class="n">mean</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 2.94456926, 43.15515565,  3.06442045])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute weighted correlation of the three variables of interest </span>
<span class="c1"># using the corrcoef attribute in statsmodels</span>
<span class="n">USocietyCovidCollider_Weighted</span><span class="o">.</span><span class="n">corrcoef</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 1.        , -0.04274411, -0.11605542],
       [-0.04274411,  1.        ,  0.09240866],
       [-0.11605542,  0.09240866,  1.        ]])
</pre></div>
</div>
</div>
</div>
<p>Note that the weighted mean and correlation coefficients differ quantitatively from the unweighted versions we computed earlier. The overall pattern of correlation is preserved.</p>
<p>Let’s interpret the weighted correlation results:</p>
<ul class="simple">
<li><p>Work at home is negatively correlated with Risk of getting COVID-19, indicating that people who rarely or never work at home perceive a greater risk of getting COVID-19.</p></li>
<li><p>Age is weakly positively correlated with Risk of getting COVID-19, indicating that perceived risk of getting COVID-19 decreases with age.</p></li>
<li><p>Age and work at home are largely not associated in the data set.</p></li>
</ul>
<p><em>Note:</em> Due to the way the variable Risk of getting COVID-19 is coded (1 = Very likely, 2 = Likely, 3 = Unlikely, 4 = Very unlikely), larger values indicate lower risk. The variable Risk of getting COVID-19 measures perceived risk, which is different from actual risk or health outcome after different age groups get COVID-19.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We model the outcome variable Risk of getting COVID-19 and the predictors</span>
<span class="c1"># Age and Work at home using a Generalized Linear Model (GLM) in statsmodels.</span>
<span class="c1"># We treat our outcome variable as quantitative and thus use the default</span>
<span class="c1"># Gaussian distribution family. Weights (cf_betaindin_xw) are applied using the</span>
<span class="c1"># parameter freq_weights.</span>

<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">glm</span><span class="p">(</span>
    <span class="s2">&quot;cf_riskcv19 ~ cf_age + cf_wah&quot;</span><span class="p">,</span>
    <span class="n">freq_weights</span><span class="o">=</span><span class="n">USocietyCovidCollider</span><span class="o">.</span><span class="n">cf_betaindin_xw</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">USocietyCovidCollider</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                 Generalized Linear Model Regression Results                  
==============================================================================
Dep. Variable:            cf_riskcv19   No. Observations:                 6683
Model:                            GLM   Df Residuals:                  7101.97
Model Family:                Gaussian   Df Model:                            2
Link Function:               identity   Scale:                         0.34918
Method:                          IRLS   Log-Likelihood:                -6342.3
Date:                Fri, 22 Jul 2022   Deviance:                       2479.9
Time:                        15:22:40   Pearson chi2:                 2.48e+03
No. Iterations:                     3                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      3.0564      0.028    107.373      0.000       3.001       3.112
cf_age         0.0038      0.001      7.455      0.000       0.003       0.005
cf_wah        -0.0523      0.005     -9.558      0.000      -0.063      -0.042
==============================================================================
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Although both Age and Work at home have some effect on </span>
<span class="c1"># Risk of getting COVID-19, the two predictors are not </span>
<span class="c1"># associated in the data set as measured via</span>
<span class="c1"># weighted correlation</span>

<span class="n">USocietyCovidCollider_Weighted</span> <span class="o">=</span> <span class="n">DescrStatsW</span><span class="p">(</span>
    <span class="n">USocietyCovidCollider</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">weights</span><span class="o">=</span><span class="n">USocietyCovidCollider</span><span class="o">.</span><span class="n">cf_betaindin_xw</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">USocietyCovidCollider_Weighted</span><span class="o">.</span><span class="n">corrcoef</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 1.        , -0.04274411],
       [-0.04274411,  1.        ]])
</pre></div>
</div>
</div>
</div>
<p>Let’s condition on the respondents who considered the risk for getting COVID-19 ‘Very likely’. This is an example of problematic conditioning on a collider variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a collider variable — Very likely risk of getting COVID-19.</span>
<span class="c1"># Select the respondents who considered the risk for getting COVID-19 &#39;Very likely&#39;.</span>

<span class="n">USocietyCovidColliderRisk</span> <span class="o">=</span> <span class="n">USocietyCovidCollider</span><span class="p">[</span>
    <span class="n">USocietyCovidCollider</span><span class="p">[</span><span class="s2">&quot;cf_riskcv19&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
<span class="p">]</span>

<span class="n">USocietyCovidColliderRisk</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cf_wah</th>
      <th>cf_age</th>
      <th>cf_riskcv19</th>
      <th>cf_betaindin_xw</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>443</th>
      <td>4.0</td>
      <td>27.0</td>
      <td>1.0</td>
      <td>0.693835</td>
    </tr>
    <tr>
      <th>619</th>
      <td>4.0</td>
      <td>25.0</td>
      <td>1.0</td>
      <td>1.627781</td>
    </tr>
    <tr>
      <th>890</th>
      <td>4.0</td>
      <td>49.0</td>
      <td>1.0</td>
      <td>0.766018</td>
    </tr>
    <tr>
      <th>1635</th>
      <td>4.0</td>
      <td>49.0</td>
      <td>1.0</td>
      <td>0.195473</td>
    </tr>
    <tr>
      <th>1969</th>
      <td>4.0</td>
      <td>28.0</td>
      <td>1.0</td>
      <td>2.347204</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>11334</th>
      <td>1.0</td>
      <td>38.0</td>
      <td>1.0</td>
      <td>0.963162</td>
    </tr>
    <tr>
      <th>11457</th>
      <td>4.0</td>
      <td>29.0</td>
      <td>1.0</td>
      <td>2.864587</td>
    </tr>
    <tr>
      <th>11593</th>
      <td>4.0</td>
      <td>42.0</td>
      <td>1.0</td>
      <td>1.980593</td>
    </tr>
    <tr>
      <th>11702</th>
      <td>4.0</td>
      <td>48.0</td>
      <td>1.0</td>
      <td>2.443001</td>
    </tr>
    <tr>
      <th>11975</th>
      <td>4.0</td>
      <td>50.0</td>
      <td>1.0</td>
      <td>0.387473</td>
    </tr>
  </tbody>
</table>
<p>63 rows × 4 columns</p>
</div></div></div>
</div>
<p>After we condition on those who considered the risk for getting COVID-19 ‘Very likely’, we observe a negative correlation between Age and Work at home.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute weighted correlation of Age and Work at home</span>

<span class="c1"># Create a weighted instance</span>
<span class="n">USocietyCovidColliderRisk_Weighted</span> <span class="o">=</span> <span class="n">DescrStatsW</span><span class="p">(</span>
    <span class="n">USocietyCovidColliderRisk</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">weights</span><span class="o">=</span><span class="n">USocietyCovidColliderRisk</span><span class="o">.</span><span class="n">cf_betaindin_xw</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Weighted correlation</span>
<span class="n">USocietyCovidColliderRisk_Weighted</span><span class="o">.</span><span class="n">corrcoef</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 1.        , -0.20653002],
       [-0.20653002,  1.        ]])
</pre></div>
</div>
</div>
</div>
<div class="section" id="questions">
<h2>Questions<a class="headerlink" href="#questions" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Why Age and Work at home were uncorrelated in the population but are negatively correlated once we condition on those who perceive ‘Very likely’ risk of getting COVID-19?</p></li>
</ul>
</div>
</div>
<div class="section" id="additional-material">
<h1>Additional material<a class="headerlink" href="#additional-material" title="Permalink to this headline">¶</a></h1>
<p>The examples and code below are from <a class="reference external" href="https://mixtape.scunning.com/dag.html">Chapter 3: Directed Acyclical Graphs</a> in Scott Cunningham’s book <a class="reference external" href="https://mixtape.scunning.com/index.html">Causal Inference: The Mixtape</a>.</p>
<p>The original code is written by <a class="reference external" href="https://github.com/tomcaputo">Thomas Caputo</a> and is available on <a class="reference external" href="https://github.com/tomcaputo/mixtape_learnr/blob/main/Python/Directed_Acyclical_Graphs.ipynb">GitHub</a>.</p>
</div>
<div class="section" id="gender-discrimination-and-collider-bias">
<h1>Gender discrimination and collider bias<a class="headerlink" href="#gender-discrimination-and-collider-bias" title="Permalink to this headline">¶</a></h1>
<p>Suppose we are interested in studying the effect of gender discrimination on earnings/wages. One approach would be to regress earnings on gender (Model 1 in the regression table below) which indeed shows that women are discriminated against. But then your model is criticised for not taking into account occupation. To address this criticism, you run another model that adjusts for occupation (Model 2 in the regression table below). The outputs of this second model indicates that women are not discriminated against; instead, they receive comparable (or even higher) pay. However, there is a problem in this second model too. Suppose that discrimination is mediated by occupation such that women tend to occupy worse jobs, which are payed less. In this scenario, by controlling for occupation we introduce bias. This is at odds with a widespread practice of adding more and more controls in a model. Such controls may not reduce but introduce bias. To get rid of the introduced bias in the discrimination example, we can condition on both occupation and ability, which is what Model 3 does in the regression table below. This unbiased conditional model confirms that women are discriminated against. In real-world settings, however, ability is unobserved, which would typically preclude us from estimating an unbiased effect of gender discrimination on earnings.</p>
<p>For a detailed account on of the discrimination example, see <a class="reference external" href="https://mixtape.scunning.com/dag.html">Chapter 3: Directed Acyclical Graphs</a> in Scott Cunningham’s book <a class="reference external" href="https://mixtape.scunning.com/index.html">Causal Inference: The Mixtape</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install Stargazer
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">stargazer.stargazer</span> <span class="kn">import</span> <span class="n">Stargazer</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: Stargazer in /Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages (0.0.5)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages/statsmodels/tsa/base/tsa_model.py:7: FutureWarning: pandas.Int64Index is deprecated and will be removed from pandas in a future version. Use pandas.Index with the appropriate dtype instead.
  from pandas import (to_datetime, Int64Index, DatetimeIndex, Period,
/Users/valentindanchev/opt/anaconda3/lib/python3.8/site-packages/statsmodels/tsa/base/tsa_model.py:7: FutureWarning: pandas.Float64Index is deprecated and will be removed from pandas in a future version. Use pandas.Index with the appropriate dtype instead.
  from pandas import (to_datetime, Int64Index, DatetimeIndex, Period,
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data generation and assumptions</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="c1"># Half of the population is female.</span>
        <span class="s2">&quot;female&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">),</span>
        <span class="c1"># Innate ability is independent of gender</span>
        <span class="s2">&quot;ability&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># All women experience discrimination</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;discrimination&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">female</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="c1"># Data generating processes</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;occupation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="mi">1</span>
    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ability&quot;</span><span class="p">]</span>
    <span class="o">+</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;female&quot;</span><span class="p">]</span>
    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;discrimination&quot;</span><span class="p">]</span>
    <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">data</span><span class="p">[</span><span class="s2">&quot;wage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="mi">1</span>
    <span class="o">-</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;discrimination&quot;</span><span class="p">]</span>
    <span class="o">+</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;occupation&quot;</span><span class="p">]</span>
    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ability&quot;</span><span class="p">]</span>
    <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>female</th>
      <th>ability</th>
      <th>discrimination</th>
      <th>occupation</th>
      <th>wage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0.936659</td>
      <td>1</td>
      <td>1.518708</td>
      <td>2.497788</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>-0.822491</td>
      <td>1</td>
      <td>-3.060495</td>
      <td>-4.638239</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>0.182544</td>
      <td>0</td>
      <td>1.682320</td>
      <td>2.632574</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>-2.152261</td>
      <td>0</td>
      <td>-2.950735</td>
      <td>-6.152687</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>0.243361</td>
      <td>1</td>
      <td>-1.869238</td>
      <td>-1.731099</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>9995</th>
      <td>1</td>
      <td>-1.193729</td>
      <td>1</td>
      <td>-3.785567</td>
      <td>-6.157548</td>
    </tr>
    <tr>
      <th>9996</th>
      <td>0</td>
      <td>0.002218</td>
      <td>0</td>
      <td>2.072743</td>
      <td>3.944768</td>
    </tr>
    <tr>
      <th>9997</th>
      <td>1</td>
      <td>-2.256762</td>
      <td>1</td>
      <td>-5.115725</td>
      <td>-8.722608</td>
    </tr>
    <tr>
      <th>9998</th>
      <td>1</td>
      <td>0.961977</td>
      <td>1</td>
      <td>-0.474545</td>
      <td>1.603516</td>
    </tr>
    <tr>
      <th>9999</th>
      <td>1</td>
      <td>0.988728</td>
      <td>1</td>
      <td>2.848932</td>
      <td>4.788099</td>
    </tr>
  </tbody>
</table>
<p>10000 rows × 5 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Regression models</span>
<span class="n">model1</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="o">.</span><span class="n">from_formula</span><span class="p">(</span><span class="s2">&quot;wage ~ female&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">model2</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="o">.</span><span class="n">from_formula</span><span class="p">(</span><span class="s2">&quot;wage ~ female + occupation&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">model3</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="o">.</span><span class="n">from_formula</span><span class="p">(</span><span class="s2">&quot;wage ~ female + occupation + ability&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Output the three regression model&#39;s results as Table</span>
<span class="n">stargazer</span> <span class="o">=</span> <span class="n">Stargazer</span><span class="p">((</span><span class="n">model1</span><span class="p">,</span> <span class="n">model2</span><span class="p">,</span> <span class="n">model3</span><span class="p">))</span>
<span class="n">stargazer</span><span class="o">.</span><span class="n">custom_columns</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;Biased Unconditional&quot;</span><span class="p">,</span> <span class="s2">&quot;Biased&quot;</span><span class="p">,</span> <span class="s2">&quot;Unbiased Conditional&quot;</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">stargazer</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table style="text-align:center"><tr><td colspan="4" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left"></td><td colspan="3"><em>Dependent variable:wage</em></td></tr><tr><td style="text-align:left"></td><tr><td></td><td colspan="1">Biased Unconditional</td><td colspan="1">Biased</td><td colspan="1">Unbiased Conditional</td></tr><tr><td style="text-align:left"></td><td>(1)</td><td>(2)</td><td>(3)</td></tr><tr><td colspan="4" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left">Intercept</td><td>1.975<sup>***</sup></td><td>0.215<sup>***</sup></td><td>1.027<sup>***</sup></td></tr><tr><td style="text-align:left"></td><td>(0.060)</td><td>(0.020)</td><td>(0.018)</td></tr><tr><td style="text-align:left">ability</td><td></td><td></td><td>2.001<sup>***</sup></td></tr><tr><td style="text-align:left"></td><td></td><td></td><td>(0.023)</td></tr><tr><td style="text-align:left">female</td><td>-2.886<sup>***</sup></td><td>0.566<sup>***</sup></td><td>-1.041<sup>***</sup></td></tr><tr><td style="text-align:left"></td><td>(0.085)</td><td>(0.029)</td><td>(0.029)</td></tr><tr><td style="text-align:left">occupation</td><td></td><td>1.789<sup>***</sup></td><td>0.990<sup>***</sup></td></tr><tr><td style="text-align:left"></td><td></td><td>(0.006)</td><td>(0.010)</td></tr><td colspan="4" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align: left">Observations</td><td>10,000</td><td>10,000</td><td>10,000</td></tr><tr><td style="text-align: left">R<sup>2</sup></td><td>0.104</td><td>0.909</td><td>0.949</td></tr><tr><td style="text-align: left">Adjusted R<sup>2</sup></td><td>0.104</td><td>0.909</td><td>0.949</td></tr><tr><td style="text-align: left">Residual Std. Error</td><td>4.236 (df=9998)</td><td>1.352 (df=9997)</td><td>1.012 (df=9996)</td></tr><tr><td style="text-align: left">F Statistic</td><td>1160.216<sup>***</sup> (df=1; 9998)</td><td>49770.418<sup>***</sup> (df=2; 9997)</td><td>61804.591<sup>***</sup> (df=3; 9996)</td></tr><tr><td colspan="4" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align: left">Note:</td>
 <td colspan="3" style="text-align: right">
  <sup>*</sup>p&lt;0.1;
  <sup>**</sup>p&lt;0.05;
  <sup>***</sup>p&lt;0.01
 </td></tr></table></div></div>
</div>
<div class="section" id="id1">
<h2>Questions<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>What is the true direct effect of discrimination on wages?</p></li>
<li><p>Through what channels discrimination impacts wages?</p></li>
<li><p>What makes occupation a collider?</p></li>
<li><p>What control variables can get rid of the collider bias?</p></li>
</ul>
</div>
</div>
<div class="section" id="references">
<h1>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h1>
<p>Scott Cunningham. <a class="reference external" href="https://mixtape.scunning.com/index.html">Causal Inference: The Mixtape</a>. Yale University Press.</p>
<p>Thomas Caputo. <a class="reference external" href="https://github.com/tomcaputo/mixtape_learnr">Teaching Resources for Causal Inference: The Mixtape</a>. GitHub.</p>
<p>Hernán MA, Robins JM (2020). <a class="reference external" href="https://cdn1.sph.harvard.edu/wp-content/uploads/sites/1268/2021/01/ciwhatif_hernanrobins_31jan21.pdf">Causal Inference: What If</a>. Boca Raton: Chapman &amp; Hall/CRC.</p>
<p>Richard McElreath. Chapter 6: The Haunted DAG &amp; The Causal Terror. <a class="reference external" href="https://xcelab.net/rm/statistical-rethinking/">Statistical Rethinking: A Bayesian Course with Examples in R and Stan</a> (2nd ed). Chapman and Hall/CRC.</p>
<p>Richard McElreath’s lecture on <a class="reference external" href="https://www.youtube.com/watch?v=l_7yIUqWBmE">basic causal inference</a>, collider bias, and back-door criterion.</p>
<p>Stephen L. Morgan and Christopher Winship. <a class="reference external" href="https://www.cambridge.org/core/books/counterfactuals-and-causal-inference/5CC81E6DF63C5E5A8B88F79D45E1D1B7">Counterfactuals and Causal Inference</a>. Cambridge University Press.</p>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="07_prediction_using_supervised_learning.html" title="previous page">Learning from Data to Predict</a>
    <a class='right-next' id="next-link" href="09_network_analysis.html" title="next page">Network analysis with NetworkX</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Valentin Danchev<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>